(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[610],{7517:(e,t,l)=>{Promise.resolve().then(l.bind(l,4333))},4333:(e,t,l)=>{"use strict";l.d(t,{default:()=>X});var s=l(5155),a=l(6441),r=l(2471),n=l(2115),i=l(6046),d=l(7997),o=l(5446),c=l(8183),u=l(5863);let m=["analytics","disclaimers","pageanalyticsattributes","alt","analyticsattributes","url"],x={ENRICHMENT_TRIGGERED:"Queued for enrichment",WAITING_FOR_RESULTS:"Awaiting AI output",ENRICHMENT_RUNNING:"Enrichment running",PARTIALLY_ENRICHED:"Partially enriched",ENRICHMENT_COMPLETE:"Enrichment complete",ERROR:"Failed"},h={ENRICHMENT_TRIGGERED:{className:"text-indigo-700",dot:"bg-indigo-400",background:"bg-indigo-50"},WAITING_FOR_RESULTS:{className:"text-amber-700",dot:"bg-amber-400",background:"bg-amber-50"},ENRICHMENT_RUNNING:{className:"text-sky-700",dot:"bg-sky-400",background:"bg-sky-50"},ENRICHMENT_COMPLETE:{className:"text-emerald-700",dot:"bg-emerald-500",background:"bg-emerald-50"},PARTIALLY_ENRICHED:{className:"text-sky-700",dot:"bg-sky-400",background:"bg-sky-50"},ERROR:{className:"text-rose-700",dot:"bg-rose-400",background:"bg-rose-50"}},p=e=>"object"==typeof e&&null!==e,f=e=>{try{let t=JSON.parse(e);if(Array.isArray(t))return t.map(e=>"string"==typeof e?e.trim():void 0).filter(e=>!!e)}catch(e){}return[]},g=e=>e.split(/[,|;>]+/).map(e=>e.trim()).filter(Boolean),b=e=>{if(Array.isArray(e))return e.map(e=>{if("string"==typeof e)return e.trim();if(p(e)){var t,l,s,a;return null!==(a=null!==(s=null!==(l=null!==(t=(0,u.Xl)(e.label))&&void 0!==t?t:(0,u.Xl)(e.name))&&void 0!==l?l:(0,u.Xl)(e.value))&&void 0!==s?s:(0,u.Xl)(e.text))&&void 0!==a?a:void 0}}).filter(e=>!!e);if("string"==typeof e){let t=e.trim();if(!t)return[];if(t.startsWith("[")&&t.endsWith("]")){let e=f(t);if(e.length)return e}return g(t)}if(p(e)){if(Array.isArray(e.values))return b(e.values);if(Array.isArray(e.items))return b(e.items);if(Array.isArray(e.labels))return b(e.labels);if(Array.isArray(e.tags))return b(e.tags)}return[]},v=(e,t)=>{for(let l of t)for(let t of e){let e=(0,u.Xl)(t[l]);if(e)return e}},y=(e,t)=>{for(let l of t)for(let t of e){let e=b(t[l]);if(e.length)return e}return[]},N=e=>{for(let h of e){var t,l,s,a,r,n,i,d,o,c,m,x;let e=null!==(a=null!==(s=null!==(l=null!==(t=(0,u.Xl)(h.sentiment))&&void 0!==t?t:(0,u.Xl)(h.sentimentLabel))&&void 0!==l?l:(0,u.Xl)(h.sentiment_label))&&void 0!==s?s:(0,u.Xl)(h.tone))&&void 0!==a?a:(0,u.Xl)(h.mood),f=null!==(i=null!==(n=null!==(r=F(h.sentimentScore))&&void 0!==r?r:F(h.sentiment_score))&&void 0!==n?n:F(h.score))&&void 0!==i?i:F(h.sentimentConfidence);if(e)return{label:e,score:f};let g=null!==(d=p(h.sentiment)?h.sentiment:null)&&void 0!==d?d:p(h.sentimentAnalysis)?h.sentimentAnalysis:null;if(g){let e=null!==(c=null!==(o=(0,u.Xl)(g.label))&&void 0!==o?o:(0,u.Xl)(g.result))&&void 0!==c?c:(0,u.Xl)(g.tone);if(e)return{label:e,score:null!==(x=null!==(m=F(g.score))&&void 0!==m?m:F(g.confidence))&&void 0!==x?x:f}}}return null},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>5||null==e)return[];if(Array.isArray(e)){let l=e.filter(p);if(l.length)return l;for(let l of e){let e=j(l,t+1);if(e.length)return e}return[]}if(p(e)){for(let t of Object.values(e))if(Array.isArray(t)){let e=t.filter(p);if(e.length)return e}for(let l of Object.values(e)){let e=j(l,t+1);if(e.length)return e}}return[]},w=function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(l>5)&&null!=e){if(p(e)){for(let l of t)if(l in e){let t=F(e[l]);if(void 0!==t)return t}for(let s of Object.values(e)){let e=w(s,t,l+1);if(void 0!==e)return e}}else if(Array.isArray(e))for(let s of e){let e=w(s,t,l+1);if(void 0!==e)return e}}},E=e=>({totalFieldsTagged:w(e,["totalFieldsTagged","fieldsTagged","taggedFields","totalFields","fieldCount","total_fields_tagged","total_tagged_fields","total_enriched_fields","total_enriched_elements"]),readabilityDelta:w(e,["readabilityImproved","readabilityDelta","readabilityScoreDelta","readability","readabilityImprovement","readability_improved","readability_gain","readability_gain_percent","readabilityIncreasePercent"]),errorsFound:w(e,["errorsFound","errorCount","errors","errors_detected","error_total"])}),_=(e,t)=>{for(let l of t)for(let t of e){let e=F(t[l]);if(void 0!==e)return e}},I=e=>{if(!e)return{metrics:{},elements:[]};let t=p(e)&&e.body&&"object"==typeof e.body?e.body:e,l=E(t),s=[];if(p(t)){for(let e of["enriched_content_elements","enrichedContentElements","enrichment_sections","enrichmentSections","elements","records","rows","data"])if(Array.isArray(t[e])&&(s=t[e].filter(p)).length)break}if(s.length||(s=j(t)),!s.length)return{metrics:l,elements:[]};let a=s.map((e,t)=>{var l,s,a,r,n,i,d;let o=[e];["data","attributes","meta","context","details","fields"].forEach(t=>{let l=e[t];p(l)&&o.push(l)});let c=null!==(l=v(o,["id","sectionId","elementId","element_id","contentId","content_id","hash","recordId"]))&&void 0!==l?l:"element-".concat(t),u=null!==(s=v(o,["item_original_field_name","itemOriginalFieldName","originalFieldName","original_field_name","title","label","name","field","section","heading","elementTitle","element_title","content_name"]))&&void 0!==s?s:"Element ".concat(t+1),m=null!==(a=v(o,["item_source_path","itemSourcePath","path","source_path","breadcrumb","hierarchy","location","elementPath","element_path","sectionPath","section_path"]))&&void 0!==a?a:v(o,["parent","group","category"]),x=null!==(r=v(o,["copy","content","text","value","enrichedCopy","enriched_copy","output","body","copy_text","copyText","copyValue","aiCopy","ai_copy","cleansedText","cleansed_text","cleansedValue","cleansed_value","cleansedContent","cleansed_content","cleansedCopy","cleansed_copy"]))&&void 0!==r?r:void 0,h=null!==(d=null!==(i=null!==(n=v(o,["summary","aiSummary","insights","analysis","result"]))&&void 0!==n?n:v(o,["summary_text","ai_summary","summaryText"]))&&void 0!==i?i:x)&&void 0!==d?d:void 0,f=y(o,["classification","classifications","categories","category","taxonomy","classification_path","classificationPath","category_path"]),g=y(o,["keywords","keywordList","searchKeywords"]),b=y(o,["tags","labels","contentTags","tagList","content_tags"]),j=N(o);return{id:c,title:u,path:null!=m?m:void 0,copy:x,summary:h,classification:f,keywords:g,tags:b,sentiment:j,meta:{fieldsTagged:_(o,["fieldsTagged","fieldCount","totalFieldsTagged","total_fields_tagged"]),readabilityDelta:_(o,["readabilityImproved","readabilityDelta","readabilityScoreDelta","readability_improved","readability_gain"]),errorsFound:_(o,["errorsFound","errorCount","errors"])}}}),r={...l};if(null==r.totalFieldsTagged){let e=a.reduce((e,t)=>{var l,s;return e+(null!==(s=null===(l=t.meta)||void 0===l?void 0:l.fieldsTagged)&&void 0!==s?s:0)},0)||(a.length?a.length:0);r.totalFieldsTagged=e||null}if(null==r.readabilityDelta){var n,i;let e=null===(i=a.find(e=>{var t;return(null===(t=e.meta)||void 0===t?void 0:t.readabilityDelta)!==void 0}))||void 0===i?void 0:null===(n=i.meta)||void 0===n?void 0:n.readabilityDelta;r.readabilityDelta=null!=e?e:null}if(null==r.errorsFound){let e=a.reduce((e,t)=>{var l,s;return e+(null!==(s=null===(l=t.meta)||void 0===l?void 0:l.errorsFound)&&void 0!==s?s:0)},0);r.errorsFound=e||null}return{metrics:r,elements:a}},k=e=>{var t,l,s;let a=e.includes("::")&&null!==(l=null===(t=e.split("::").pop())||void 0===t?void 0:t.trim())&&void 0!==l?l:e,r=a.split("/").filter(Boolean);return(null!==(s=r[r.length-1])&&void 0!==s?s:a).replace(/[-_]/g," ").trim()||"Enriched section"},T=(e,t)=>{var l,s;return(null===(l=e.path)||void 0===l?void 0:l.trim())?e.path.trim():(null===(s=e.title)||void 0===s?void 0:s.trim())?"title:".concat(e.title.trim().toLowerCase()):"group-".concat(t)},A=(e,t,l)=>{var s,a,r;return e.startsWith("title:")?e.replace(/^title:/,""):(null===(s=t.path)||void 0===s?void 0:s.trim())?k(t.path):null!==(r=null===(a=t.title)||void 0===a?void 0:a.trim())&&void 0!==r?r:"Element group ".concat(l+1)},S=e=>{var t;let l=null===(t=e.title)||void 0===t?void 0:t.toLowerCase().trim();return!!l&&m.some(e=>l===e||l.startsWith("".concat(e,"["))||l.startsWith("".concat(e,"."))||l.includes("".concat(e,":")))},R=[{status:"ENRICHMENT_TRIGGERED",timestamp:0},{status:"WAITING_FOR_RESULTS",timestamp:0}],C=async e=>{let t=await e.text(),l=t.trim(),s=null;if(l.length)try{s=JSON.parse(l)}catch(e){s=null}return{body:s,rawBody:(l.startsWith("<!DOCTYPE")||l.startsWith("<html"))&&e.status?"".concat(e.status," ").concat(e.statusText||"").trim()||"HTML response returned.":t}},F=e=>{if("number"==typeof e&&Number.isFinite(e))return e},L=(e,t)=>null!=t?t:{name:"Unknown dataset",size:0,source:"Unknown source",uploadedAt:Date.now(),cleansedId:e},D=(e,t,l)=>{var s,a,r,n,i,d,o,c,m,x,h;if(!e)return t;let p=e.metadata&&"object"==typeof e.metadata?e.metadata:null,f={...t};if(p){f.name=null!==(s=(0,u.Xl)(p.name))&&void 0!==s?s:f.name,f.source=null!==(a=(0,u.Xl)(p.source))&&void 0!==a?a:f.source,f.cleansedId=null!==(r=(0,u.Xl)(p.cleansedId))&&void 0!==r?r:f.cleansedId,f.sourceIdentifier=null!==(n=(0,u.Xl)(p.sourceIdentifier))&&void 0!==n?n:f.sourceIdentifier,f.sourceType=null!==(i=(0,u.Xl)(p.sourceType))&&void 0!==i?i:f.sourceType;let e=F(p.uploadedAt);e&&(f.uploadedAt=e);let t=F(p.size);void 0!==t&&(f.size=t)}let g=null!==(o=null!==(d=(0,u.Xl)(e.sourceIdentifier))&&void 0!==d?d:(0,u.Xl)(e.sourceUri))&&void 0!==o?o:f.sourceIdentifier,b=null!==(c=(0,u.Me)((0,u.Xl)(e.sourceType),null!=g?g:f.sourceIdentifier,f.sourceType))&&void 0!==c?c:f.sourceType;return f.sourceIdentifier=null!=g?g:f.sourceIdentifier,f.sourceType=b,f.source=(0,u.VG)(b,f.source),f.cleansedId=null!==(h=null!==(x=null!==(m=(0,u.Xl)(e.cleansedId))&&void 0!==m?m:(0,u.Xl)(e.cleansedDataStoreId))&&void 0!==x?x:f.cleansedId)&&void 0!==h?h:l,f},M=e=>e?{metadata:e.metadata,startedAt:e.startedAt,statusHistory:e.statusHistory}:null,O=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){for(let t of["summary","aiSummary","insights","result","text","content"]){let l=e[t];if("string"==typeof l&&l.trim())return l}return JSON.stringify(e,null,2)}return"Awaiting enrichment results."};function X(){var e,t,l,m,p,f,g,b,v,y,N,j,w;let E=(0,i.useRouter)(),_=(0,i.useSearchParams)().get("id"),X=M((0,d.rS)()),[H,U]=(0,n.useState)(X),[G,P]=(0,n.useState)(!X),[W,B]=(0,n.useState)(null),[z,V]=(0,n.useState)({state:"idle"}),[Y,J]=(0,n.useState)({state:"idle"}),[K,q]=(0,n.useState)(null),[Q,Z]=(0,n.useState)(null),[$,ee]=(0,n.useState)(null),[et,el]=(0,n.useState)(null!==(m=null!=_?_:null==X?void 0:X.metadata.cleansedId)&&void 0!==m?m:null);(0,n.useEffect)(()=>{var e;let t=null!==(e=null==X?void 0:X.metadata.cleansedId)&&void 0!==e?e:null;el(null!=_?_:t)},[_,null==X?void 0:X.metadata.cleansedId]);let es=async e=>{var t,l,s,a,r;let n=await fetch("/api/ingestion/enrichment/status?id=".concat(encodeURIComponent(e))),{body:i,rawBody:d}=await C(n);if(!n.ok)throw Error(null!==(l=null!==(t=null==i?void 0:i.error)&&void 0!==t?t:d)&&void 0!==l?l:"Backend rejected the enrichment status request.");let o=null!=i?i:{},c=null;o.body&&"object"==typeof o.body?c=o.body:"body"in o||"object"!=typeof o||(c=o);let u=D(c,L(e,null!==(s=null==X?void 0:X.metadata)&&void 0!==s?s:void 0),e),m=Array.isArray(null==c?void 0:c.statusHistory)?null==c?void 0:c.statusHistory:null;return{metadata:u,startedAt:null!==(r=null!==(a=F(null==c?void 0:c.startedAt))&&void 0!==a?a:F(o.startedAt))&&void 0!==r?r:Date.now(),statusHistory:m&&m.length?m:R}},ea=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{showSpinner:l=!0,rethrowOnError:s=!1}=t;if(!e)return P(!1),B("Provide a cleansed ID via the URL or trigger a new run."),U(X),null;l&&P(!0),B(null);try{let t=await es(e);return U(t),t}catch(e){if(B(e instanceof Error?e.message:"Unable to load enrichment status."),!l&&X?U(X):X||U(null),s)throw e;return null}finally{l&&P(!1)}},er=async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t&&J({state:"loading"});try{var l,s,a,r,n;let t=await fetch("/api/ingestion/enrichment/result?id=".concat(encodeURIComponent(e))),{body:i,rawBody:d}=await C(t);if(!t.ok){if(404===t.status){q(null),Z("Awaiting enrichment results."),J({state:"idle"});return}throw Error(null!==(s=null!==(l=null==i?void 0:i.error)&&void 0!==l?l:d)&&void 0!==s?s:"Backend rejected the enrichment result request.")}let o=null!=i?i:{},c=I(o);q(c);let u=null!==(n=null!==(r=null!==(a=o.body)&&void 0!==a?a:o.rawBody)&&void 0!==r?r:d)&&void 0!==n?n:"Awaiting enrichment results.";c.elements.length?(Z(null),U(e=>e)):Z(O(u)),J({state:"idle"})}catch(e){q(null),Z(null),J({state:"error",message:e instanceof Error?e.message:"Unable to load enrichment results."})}},en=(0,n.useMemo)(()=>(null==K?void 0:K.elements.length)?K.elements.filter(e=>!S(e)):[],[null==K?void 0:K.elements]),ei=(0,n.useMemo)(()=>{if(!en.length)return[];let e=new Map;return en.forEach((t,l)=>{let s=T(t,l),a=e.get(s);if(a){a.elements.push(t);return}e.set(s,{label:A(s,t,l),elements:[t]})}),Array.from(e.entries()).map(e=>{let[t,l]=e;return{id:t||"group-".concat(l.label,"-").concat(l.elements.length),label:l.label,elements:l.elements}})},[en]),[ed,eo]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{if(!ei.length){eo(new Set),ee(null);return}eo(new Set(ei.map(e=>e.id))),ee(e=>{var t,l;return e&&en.some(t=>t.id===e)?e:null!==(l=null===(t=en[0])||void 0===t?void 0:t.id)&&void 0!==l?l:null})},[ei,en]);let ec=e=>{eo(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l})},eu=e=>{ee(t=>t===e?null:e)};(0,n.useEffect)(()=>{ea(et).catch(()=>void 0)},[et]),(0,n.useEffect)(()=>{(null==H?void 0:H.metadata.cleansedId)&&er(H.metadata.cleansedId,!0)},[null==H?void 0:H.metadata.cleansedId]);let em=(null==H?void 0:null===(e=H.statusHistory)||void 0===e?void 0:e.length)?H.statusHistory:R,ex=null!==(p=null===(t=em[em.length-1])||void 0===t?void 0:t.status)&&void 0!==p?p:"WAITING_FOR_RESULTS",eh=null!==(f=h[ex])&&void 0!==f?f:{className:"text-slate-700",dot:"bg-slate-300",background:"bg-slate-100"},ep=(0,n.useMemo)(()=>{let e=["ENRICHMENT_TRIGGERED","WAITING_FOR_RESULTS","ENRICHMENT_RUNNING","PARTIALLY_ENRICHED","ENRICHMENT_COMPLETE"],t=e.findIndex(e=>e===ex);return t>=0?(t+1)/e.length*100:Math.min(em.length,e.length)/e.length*100},[ex,em.length]);(0,n.useEffect)(()=>{if(!ei.length){eo(new Set),ee(null);return}eo(new Set(ei.map(e=>e.id))),ee(e=>{var t,l;return e&&en.some(t=>t.id===e)?e:null!==(l=null===(t=en[0])||void 0===t?void 0:t.id)&&void 0!==l?l:null})},[ei,en]);let ef=null!==(g=null==K?void 0:K.metrics)&&void 0!==g?g:{},eg=null!==ef.totalFieldsTagged&&void 0!==ef.totalFieldsTagged?Math.round(ef.totalFieldsTagged):null,eb=null!==ef.readabilityDelta&&void 0!==ef.readabilityDelta?ef.readabilityDelta:null,ev=null!==ef.errorsFound&&void 0!==ef.errorsFound?ef.errorsFound:null,ey=null!==eb&&Number.isFinite(eb)?1>=Math.abs(eb)?100*eb:eb:null,eN=null!==ey?"".concat(ey>0?"+":"").concat(Math.round(ey),"%"):null,ej=null!==ev?Math.max(0,Math.round(ev)):null,ew=(e,t)=>e.length?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,s.jsx)("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-semibold text-slate-700",children:e},e))}):(0,s.jsx)("p",{className:"text-sm text-slate-500",children:t}),eE=async()=>{if(!et){V({state:"error",message:"Cleansed ID missing; re-run cleansing before enrichment."});return}V({state:"loading"});try{await ea(et,{showSpinner:!1,rethrowOnError:!0}),V({state:"success",message:"Status refreshed."}),await er(et,!1)}catch(e){V({state:"error",message:e instanceof Error?e.message:"Unable to refresh status."})}};if(G)return(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 px-6 py-20",children:(0,s.jsxs)("div",{className:"max-w-xl rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Enrichment"}),(0,s.jsx)("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:"Loading status…"}),(0,s.jsx)("p",{className:"mt-4 text-sm text-slate-500",children:"Fetching enrichment details from the backend. One moment please."})]})});if(!H)return(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 px-6 py-20",children:(0,s.jsxs)("div",{className:"max-w-xl rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Enrichment"}),(0,s.jsx)("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:null!=W?W:"Enrichment data not found"}),(0,s.jsx)("p",{className:"mt-4 text-sm text-slate-500",children:"Trigger enrichment from the cleansing screen to review progress here."}),(0,s.jsx)("button",{type:"button",onClick:()=>E.push("/cleansing"),className:"mt-6 rounded-full bg-slate-900 px-6 py-2 text-sm font-semibold text-white",children:"Back to Cleansing"})]})});let e_=(0,u.VG)(null!==(b=H.metadata.sourceType)&&void 0!==b?b:H.metadata.source,H.metadata.source),eI=null!==(v=H.metadata.sourceIdentifier)&&void 0!==v?v:"—";return(0,s.jsxs)(o.l,{currentStep:"enrichment",children:[(0,s.jsx)(c.F,{title:"Enrichment",description:"Monitor enrichment for ".concat(H.metadata.name),actionsSlot:"idle"!==z.state?(0,s.jsx)("div",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ".concat("loading"===z.state?"bg-indigo-50 text-indigo-600":"success"===z.state?"bg-emerald-50 text-emerald-700":"bg-rose-50 text-rose-700"),children:null!==(y=z.message)&&void 0!==y?y:"loading"===z.state?"Refreshing status…":"success"===z.state?"Status updated.":"Unable to refresh status."}):null}),(0,s.jsxs)("main",{className:"mx-auto flex max-w-6xl flex-col gap-6 px-6 py-10",children:[(0,s.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Current status"}),(0,s.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold ".concat(eh.background," ").concat(eh.className),children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(eh.dot)}),null!==(N=x[ex])&&void 0!==N?N:ex]})]}),(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Pipeline progress"}),(0,s.jsx)("div",{className:"mt-2 h-2 rounded-full bg-slate-100",children:(0,s.jsx)("div",{className:"h-full rounded-full bg-indigo-500 transition-all",style:{width:"".concat(ep,"%")}})}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:[Math.round(ep),"% complete"]})]}),(0,s.jsx)("button",{type:"button",onClick:eE,className:"rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700 transition hover:border-indigo-300 hover:text-indigo-700",children:"Refresh Status"})]}),(0,s.jsxs)("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Total fields tagged"}),(0,s.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:null!=eg?eg:"—"})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Readability improved"}),(0,s.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:null!=eN?eN:"—"})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Errors found"}),(0,s.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:null!=ej?ej:"—"})]})]}),(0,s.jsxs)("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cleansed ID"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:null!==(j=H.metadata.cleansedId)&&void 0!==j?j:"—"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Source"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e_})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Source identifier"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900 break-all",children:eI})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Started at"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:new Date(H.startedAt).toLocaleString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Last update"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:new Date(null!==(w=null===(l=em[em.length-1])||void 0===l?void 0:l.timestamp)&&void 0!==w?w:H.startedAt).toLocaleString()})]})]})]}),(0,s.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Status timeline"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Pipeline events"}),(0,s.jsx)("div",{className:"mt-4 space-y-4 border-l border-slate-200 pl-6",children:em.map(e=>{var t,l;let a=null!==(t=h[e.status])&&void 0!==t?t:{className:"text-slate-700",dot:"bg-slate-300"};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute -left-[33px] mt-1 inline-flex h-3 w-3 rounded-full ".concat(a.dot)}),(0,s.jsx)("p",{className:"text-sm font-semibold ".concat(a.className),children:null!==(l=x[e.status])&&void 0!==l?l:e.status}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:new Date(e.timestamp).toLocaleString()})]},"".concat(e.status,"-").concat(e.timestamp))})})]}),(0,s.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Insights"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"AI summary preview"})]}),(0,s.jsx)("span",{className:"text-xs text-slate-500",children:"Read-only snapshot of the most recent enrichment output."})]}),"loading"===Y.state?(0,s.jsx)("div",{className:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-6 text-sm text-slate-500",children:"Loading enrichment summary…"}):"error"===Y.state?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-amber-200 bg-amber-50 p-4",children:[(0,s.jsx)("p",{className:"font-semibold text-amber-800",children:"Unable to load enrichment summary."}),(0,s.jsx)("p",{className:"text-xs text-amber-900/80",children:Y.message}),(0,s.jsx)("button",{type:"button",onClick:()=>H.metadata.cleansedId&&er(H.metadata.cleansedId,!0),className:"mt-3 rounded-full bg-amber-600 px-3 py-1 text-xs font-semibold text-white",children:"Retry"})]}):(null==K?void 0:K.elements.length)?(0,s.jsxs)("div",{className:"mt-6 rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Enriched sections"}),(0,s.jsxs)("div",{className:"mt-3 max-h-[480px] space-y-3 overflow-y-auto pr-2",children:[ei.map(e=>{let t=ed.has(e.id);return(0,s.jsxs)("div",{className:"rounded-xl border border-slate-100 bg-white",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>ec(e.id),className:"flex w-full items-center justify-between gap-3 px-4 py-2 text-left text-sm font-semibold text-slate-800",children:[(0,s.jsx)("span",{className:"flex-1 truncate",children:e.label}),(0,s.jsx)("span",{className:"text-xs font-semibold text-slate-400",children:e.elements.length}),t?(0,s.jsx)(a.A,{className:"size-4 text-slate-400"}):(0,s.jsx)(r.A,{className:"size-4 text-slate-400"})]}),t&&(0,s.jsx)("div",{className:"space-y-2 border-t border-slate-100 bg-slate-50 px-3 py-3",children:e.elements.map((e,t)=>{var l,n,i,d,o,c,u,m,x,h,p;let f=$===e.id,g=null===(l=e.path)||void 0===l?void 0:l.trim(),b=null!==(d=null===(n=e.title)||void 0===n?void 0:n.trim())&&void 0!==d?d:"",v=b.length>0?b:g?k(g):"Field ".concat(t+1),y=null!==(c=null!==(o=e.summary)&&void 0!==o?o:e.copy)&&void 0!==c?c:"No preview available.";return(0,s.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>eu(e.id),className:"flex w-full items-center justify-between gap-3 px-3 py-2 text-left text-sm text-slate-800",children:[(0,s.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:v}),g?(0,s.jsxs)("p",{className:"truncate text-xs text-slate-500",children:["Source path \xb7"," ",(0,s.jsx)("span",{className:"font-semibold text-slate-700",children:g})]}):(0,s.jsx)("p",{className:"truncate text-xs text-slate-500",children:y})]}),f?(0,s.jsx)(a.A,{className:"size-4 text-slate-400"}):(0,s.jsx)(r.A,{className:"size-4 text-slate-400"})]}),f&&(0,s.jsxs)("div",{className:"space-y-4 border-t border-slate-100 bg-slate-50 px-4 py-4 text-sm text-slate-700",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Enriched copy"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-slate-800",children:null!==(u=e.copy)&&void 0!==u?u:"No enriched copy provided yet."})]}),(0,s.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-slate-100 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Content insights"}),(0,s.jsx)("h3",{className:"text-base font-semibold text-slate-900",children:"Summary"})]}),(0,s.jsx)("span",{className:"text-xs font-semibold text-slate-500",children:(null===(i=e.classification)||void 0===i?void 0:i.length)?"2 fields":"1 field"})]}),(0,s.jsx)("p",{className:"mt-3 text-sm text-slate-700",children:null!==(m=e.summary)&&void 0!==m?m:"Summary not available yet."}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Classification"}),ew(null!==(x=e.classification)&&void 0!==x?x:[],"No classification detected.")]})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-slate-100 bg-white p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Search metadata"}),(0,s.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Keywords"}),ew(null!==(h=e.keywords)&&void 0!==h?h:[],"Keywords pending enrichment.")]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Content tags"}),ew(null!==(p=e.tags)&&void 0!==p?p:[],"Tags pending enrichment.")]})]})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-slate-100 bg-white p-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Tone & sentiment"}),(0,s.jsx)("div",{className:"mt-4 rounded-2xl border border-emerald-100 bg-emerald-50 p-4",children:e.sentiment?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-emerald-700",children:e.sentiment.label}),void 0!==e.sentiment.score&&(0,s.jsxs)("p",{className:"text-xs text-emerald-800",children:["Score: ",Math.round(100*e.sentiment.score)/100]})]}):(0,s.jsx)("p",{className:"text-sm text-emerald-800/80",children:"Sentiment analytics will appear after enrichment completes."})})]})]})]})]},e.id)})})]},e.id)}),!ei.length&&(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"No enriched sections available yet."})]})]}):Q?(0,s.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-100 bg-slate-50 p-4 text-sm text-slate-700",children:(0,s.jsx)("pre",{className:"whitespace-pre-wrap",children:Q})}):(0,s.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-100 bg-slate-50 p-4 text-sm text-slate-500",children:"Awaiting enrichment results. Once the backend finishes generating AI insights, they’ll appear here automatically. Use the “Refresh status” button above to check for updates."})]}),(0,s.jsx)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Next steps"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Wrap up or keep monitoring"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>E.push("/cleansing"),className:"rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700",children:"Back to Cleansing"}),(0,s.jsx)("button",{type:"button",onClick:eE,className:"rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700",children:"Refresh Status"}),(0,s.jsx)("button",{type:"button",onClick:()=>{(0,d.wo)(),E.push("/ingestion")},className:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",children:"Finish Session"})]})]})})]})]})}},6441:(e,t,l)=>{"use strict";l.d(t,{A:()=>a});var s=l(2115);let a=s.forwardRef(function(e,t){let{title:l,titleId:a,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),l?s.createElement("title",{id:a},l):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))})},2471:(e,t,l)=>{"use strict";l.d(t,{A:()=>a});var s=l(2115);let a=s.forwardRef(function(e,t){let{title:l,titleId:a,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),l?s.createElement("title",{id:a},l):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[550,995,441,517,358],()=>t(7517)),_N_E=e.O()}]);