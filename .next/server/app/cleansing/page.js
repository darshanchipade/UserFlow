(()=>{var e={};e.id=31,e.ids=[31],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},9551:e=>{"use strict";e.exports=require("url")},2071:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>o});var a=s(260),r=s(8203),l=s(5155),n=s.n(l),i=s(7292),d={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let o=["",{children:["cleansing",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4844)),"/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/cleansing/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,1354)),"/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,1485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/cleansing/page.tsx"],x={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/cleansing/page",pathname:"/cleansing",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},6371:(e,t,s)=>{Promise.resolve().then(s.bind(s,4299))},2027:(e,t,s)=>{Promise.resolve().then(s.bind(s,5215))},9334:(e,t,s)=>{"use strict";var a=s(8686);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},5215:(e,t,s)=>{"use strict";s.d(t,{default:()=>h});var a=s(5512),r=s(8009),l=s(9334),n=s(3779),i=s(9199),d=s(6287),o=s(6193);let c=[{title:"Whitespace normalization",description:"Collapses redundant spaces, tabs, and line breaks to a single space."},{title:"Markup removal",description:"Strips internal tokens (e.g. {%url%}, sosumi, wj markers) from copy blocks."},{title:"Locale-aware punctuation",description:"Replaces smart quotes, ellipsis, and em-dashes with locale-specific glyphs."},{title:"Sensitive token scrub",description:"Masks e-mail addresses, PII placeholders, and debugging metadata."}],x=e=>e?{metadata:e.metadata,status:e.status,rawBody:e.rawBody,fallbackReason:e.fallbackReason,cachedItems:m(e.items)}:null,m=e=>Array.isArray(e)?e.reduce((e,t,s)=>{if(!t||"object"!=typeof t)return e;let a=(0,o.Xl)(t.field),r=(0,o.Xl)(t.original),l=(0,o.Xl)(t.cleansed);return(a||r||l)&&e.push({id:(0,o.Xl)(t.id)??`cached-${s}`,field:a??`Item ${s+1}`,original:r??null,cleansed:l??null}),e},[]):[],u=async e=>{let t=await e.text(),s=t.trim(),a=null;if(s.length)try{a=JSON.parse(s)}catch{a=null}return{body:a,rawBody:(s.startsWith("<!DOCTYPE")||s.startsWith("<html"))&&e.status?`${e.status} ${e.statusText||""}`.trim()||"HTML response returned.":t}},p=({feedback:e})=>{if("idle"===e.state)return null;let t="loading"===e.state?"bg-indigo-50 text-indigo-600":"success"===e.state?"bg-emerald-50 text-emerald-700":"bg-rose-50 text-rose-700";return(0,a.jsx)("div",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ${t}`,children:"loading"===e.state?"Triggering enrichment…":e.message??("success"===e.state?"Enrichment triggered.":"Something went wrong.")})};function h(){let e=(0,l.useRouter)();(0,l.useSearchParams)().get("id");let t=x((0,n.DV)()),[s,m]=(0,r.useState)(t),[h,g]=(0,r.useState)(t?.cachedItems??[]),[b,f]=(0,r.useState)(!t),[j,w]=(0,r.useState)(null),[y,N]=(0,r.useState)({state:"idle"}),[v,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[P,I]=(0,r.useState)(null),[R,U]=(0,r.useState)(!1),q=async(e,t={})=>{let{showSpinner:s=!0}=t;s&&k(!0),S(null);try{let t=await fetch(`/api/ingestion/cleansed-items?id=${encodeURIComponent(e)}`),{body:s,rawBody:a}=await u(t);if(!t.ok){if(404===t.status){g([]),S("Cleansed rows are not available yet.");return}throw Error(s?.error??a??"Backend rejected the items request.")}let r=s??{},l=Array.isArray(r.items)?r.items:[];g(l),m(e=>e?{...e,cachedItems:l,rawBody:"string"==typeof s?.rawBody?s.rawBody:e.rawBody}:e)}catch(e){S(e instanceof Error?e.message:"Unable to fetch cleansed items.")}finally{s&&k(!1)}},E=async()=>{if(!s?.metadata.cleansedId){N({state:"error",message:"Cleansed ID is missing. Re-run extraction before enrichment."});return}N({state:"loading",message:"Triggering enrichment…"});try{let t=await fetch("/api/ingestion/enrichment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.metadata.cleansedId})}),a=await t.json();if(!t.ok){N({state:"error",message:a?.error??"Backend rejected the request."});return}let r=Date.now();(0,n.q6)({metadata:s.metadata,startedAt:r,statusHistory:[{status:"ENRICHMENT_TRIGGERED",timestamp:r},{status:"string"==typeof a?.body?.status?a.body.status:"WAITING_FOR_RESULTS",timestamp:r}]}),N({state:"success",message:"Enrichment pipeline triggered."}),e.push(`/enrichment?id=${encodeURIComponent(s.metadata.cleansedId)}`)}catch(e){N({state:"error",message:e instanceof Error?e.message:"Unable to reach enrichment service."})}};if(b||!R)return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 px-6 py-16",children:(0,a.jsxs)("div",{className:"max-w-lg rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cleansing"}),(0,a.jsx)("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:"Loading context…"}),(0,a.jsx)("p",{className:"mt-3 text-sm text-slate-500",children:"Fetching cleansed snapshot from the backend. One moment please."})]})});if(!s)return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 px-6 py-16",children:(0,a.jsxs)("div",{className:"max-w-lg rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cleansing"}),(0,a.jsx)("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:j??"Cleansed context not found"}),(0,a.jsx)("p",{className:"mt-3 text-sm text-slate-500",children:"Provide a valid `id` query parameter or trigger the pipeline again."}),(0,a.jsx)("button",{type:"button",onClick:()=>e.push("/extraction"),className:"mt-6 rounded-full bg-slate-900 px-6 py-2 text-sm font-semibold text-white",children:"Back to Extraction"})]})});let B=(0,o.VG)(s.metadata.sourceType??s.metadata.source,s.metadata.source),F=s.metadata.sourceIdentifier??"—";return(0,a.jsxs)(i.l,{currentStep:"cleansing",children:[(0,a.jsx)(d.F,{title:"Cleansing",description:`Review cleansed output for ${s.metadata.name} before sending it forward.`,actionsSlot:(0,a.jsx)(p,{feedback:y})}),(0,a.jsxs)("main",{className:"mx-auto flex max-w-6xl flex-col gap-6 px-6 py-10",children:[(0,a.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Status"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s.status??"Pending"})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[(0,a.jsx)("p",{children:"Uploaded"}),(0,a.jsx)("p",{className:"font-semibold text-slate-800",children:new Date(s.metadata.uploadedAt).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cleansed ID"}),(0,a.jsx)("dd",{className:"text-sm font-semibold text-slate-900",children:s.metadata.cleansedId??"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Source"}),(0,a.jsx)("dd",{className:"text-sm font-semibold text-slate-900",children:B})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Source identifier"}),(0,a.jsx)("dd",{className:"text-sm font-semibold text-slate-900 break-all",children:F})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cache status"}),(0,a.jsx)("dd",{className:"text-sm font-semibold text-slate-900",children:"quota"===s.fallbackReason?"Partial snapshot":"Complete snapshot"})]})]})]}),(0,a.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Items"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Original vs Cleansed values"})]})}),v?(0,a.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-200 bg-slate-50 py-10 text-center text-sm text-slate-600",children:"Fetching latest cleansed rows…"}):C?(0,a.jsxs)("div",{className:"mt-4 rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Unable to load cleansed items."}),(0,a.jsx)("p",{className:"mt-1",children:C}),(0,a.jsx)("button",{type:"button",onClick:()=>s.metadata.cleansedId&&q(s.metadata.cleansedId),className:"mt-3 rounded-full bg-amber-600 px-3 py-1 text-xs font-semibold text-white",children:"Retry fetch"})]}):0===h.length?(0,a.jsx)("div",{className:"mt-4 rounded-2xl border border-dashed border-slate-200 py-10 text-center text-sm text-slate-500",children:"No cleansed items available yet."}):(0,a.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-100",children:(0,a.jsx)("div",{className:"max-h-[480px] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Field"}),(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Original value"}),(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Cleansed value"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:h.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-3 align-top font-semibold text-slate-900",children:e.field}),(0,a.jsx)("td",{className:"px-4 py-3 align-top text-slate-700",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:e.original??"—"})}),(0,a.jsx)("td",{className:"px-4 py-3 align-top text-slate-700",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:e.cleansed??"—"})})]},e.id??`${e.field??"row"}-${t}`))})]})})})]}),(0,a.jsx)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Applied rules"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Cleansing heuristics snapshot"})]}),(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4 shadow-inner",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.title}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:e.description})]},e.title))})]})}),(0,a.jsx)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Next steps"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Ready to send for enrichment?"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>e.push("/extraction"),className:"rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700",children:"Back to Extraction"}),(0,a.jsx)("button",{type:"button",onClick:E,disabled:"loading"===y.state,className:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white disabled:cursor-not-allowed disabled:opacity-70",children:"loading"===y.state?"Sending to Enrichment…":"Send to Enrichment"}),(0,a.jsx)("button",{type:"button",onClick:()=>{(0,n.sB)(),e.push("/ingestion")},className:"rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700",children:"Start Over"})]})]})})]})]})}},3779:(e,t,s)=>{"use strict";s.d(t,{DV:()=>x,Wq:()=>n,mv:()=>c,q6:()=>u,qv:()=>d,rS:()=>p,sB:()=>m,wo:()=>h,xj:()=>i});let a="cleansed-context",r=(e,t)=>({ok:!1,reason:"ssr"}),l=e=>{let t={...e,backendPayload:void 0};return"string"==typeof t.rawJson&&t.rawJson.length>5e5&&(t.rawJson=t.rawJson.slice(0,5e5)),t},n=e=>r("extraction-context",l(e)),i=()=>null,d=()=>{},o=e=>{let t={...e,items:Array.isArray(e.items)?[...e.items]:[]};return t.items.length>150&&(t.items=t.items.slice(0,150),t.itemsTruncated=!0),"string"==typeof t.rawBody&&t.rawBody.length>2e5&&(t.rawBody=t.rawBody.slice(0,2e5),t.rawBodyTruncated=!0),t},c=e=>{let t=o(e),s=r(a,t);if(!s.ok&&"quota"===s.reason){let e=r(a,{metadata:t.metadata,status:t.status,items:[],fallbackReason:"quota"});return e.ok?{ok:!0,reason:"quota",usedFallback:!0}:e}return s},x=()=>null,m=()=>{},u=e=>r("enrichment-context",e),p=()=>null,h=()=>{}},6193:(e,t,s)=>{"use strict";s.d(t,{Me:()=>r,VG:()=>l,Xl:()=>a});let a=e=>{if("string"!=typeof e)return;let t=e.trim();return t.length?t:void 0},r=(e,t,s)=>{let a=e?.toLowerCase();if(a)return a;if(!t)return s;let r=t.toLowerCase();return r.startsWith("file-upload")||r.startsWith("local:")?"file":r.startsWith("api-payload")||r.includes("api")?"api":r.startsWith("s3://")||r.includes("s3")?"s3":r.startsWith("classpath:")?"classpath":s},l=(e,t="Unknown source")=>{if(!e)return t;let s=e.toLowerCase();return s.includes("api")?"API payload":s.includes("s3")||s.includes("cloud")?"S3 / Cloud":s.includes("class")?"Classpath resource":s.includes("local")?"Local upload":s.includes("file")?"File upload":e}},4299:(e,t,s)=>{"use strict";s.d(t,{default:()=>a});let a=(0,s(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/cleansing/CleansingPageClient.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/cleansing/CleansingPageClient.tsx","default")},4844:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(2740),r=s(6301),l=s(4299);function n(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50 px-6 py-20",children:(0,a.jsxs)("div",{className:"max-w-xl rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Cleansing"}),(0,a.jsx)("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:"Loading cleansing run…"}),(0,a.jsx)("p",{className:"mt-4 text-sm text-slate-500",children:"Fetching the latest cleansing context."})]})}),children:(0,a.jsx)(l.default,{})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[638,619,77,30,546],()=>s(2071));module.exports=a})();