(()=>{var t={};t.id=853,t.ids=[853],t.modules={846:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:t=>{"use strict";t.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5800:(t,e,s)=>{"use strict";s.r(e),s.d(e,{patchFetch:()=>O,routeModule:()=>m,serverHooks:()=>C,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{GET:()=>_});var a=s(2706),n=s(8203),i=s(5994),u=s(9187);let o=process.env.SPRINGBOOT_BASE_URL,E=["ENRICHMENT_TRIGGERED","WAITING_FOR_RESULTS","ENRICHMENT_RUNNING","PARTIALLY_ENRICHED","ENRICHMENT_COMPLETE"],R={CLEANSED_PENDING_ENRICHMENT:"ENRICHMENT_TRIGGERED",QUEUED_FOR_ENRICHMENT:"ENRICHMENT_TRIGGERED",ENRICHMENT_QUEUED:"ENRICHMENT_TRIGGERED",WAITING_FOR_AI_OUTPUT:"WAITING_FOR_RESULTS",AWAITING_AI_OUTPUT:"WAITING_FOR_RESULTS",WAITING_FOR_RESULTS:"WAITING_FOR_RESULTS",ENRICHMENT_IN_PROGRESS:"ENRICHMENT_RUNNING",ENRICHMENT_PROCESSING:"ENRICHMENT_RUNNING",AI_ENRICHMENT_IN_PROGRESS:"ENRICHMENT_RUNNING",ENRICHMENT_STARTED:"ENRICHMENT_RUNNING",ENRICHMENT_DONE:"ENRICHMENT_COMPLETE",ENRICHED:"ENRICHMENT_COMPLETE",COMPLETED:"ENRICHMENT_COMPLETE"},N=t=>{try{return JSON.parse(t)}catch{return t}},p=t=>"object"==typeof t&&null!==t,l=t=>{if("string"!=typeof t)return;let e=t.trim();return e.length?e:void 0},I=t=>{if("number"==typeof t&&Number.isFinite(t))return t;if("string"==typeof t){let e=Number.parseFloat(t);if(!Number.isNaN(e)&&Number.isFinite(e))return e}},d=t=>{let e=l(t)??(p(t)?l(t.status)??l(t.currentStatus)??l(t.pipelineStatus):void 0);if(!e)return null;let s=e.replace(/\s+/g,"_").replace(/-+/g,"_").toUpperCase();return R[s]?R[s]:E.includes(s)||"ERROR"===s?s:null},T=(t,e)=>{if(!Array.isArray(t))return[];let s=new Set,r=[];for(let a of t){if(!p(a))continue;let t=d(a.status);if(!t||s.has(t))continue;let n=I(a.timestamp)??e;r.push({status:t,timestamp:n}),s.add(t)}return r},c=(t,e,s)=>{let r=e?E.indexOf(e):-1,a=[...t];if(e&&!a.some(t=>t.status===e)&&a.push({status:e,timestamp:Date.now()}),a.length)a.sort((t,e)=>t.timestamp-e.timestamp);else{let t=Number.isFinite(s)?s:Date.now(),n=r>=0?E.slice(0,r+1):[E[0],E[1]];n.forEach((e,s)=>{a.push({status:e,timestamp:t+6e4*s})}),"ERROR"===e&&a.push({status:"ERROR",timestamp:t+6e4*n.length})}"ERROR"!==e||a.some(t=>"ERROR"===t.status)||a.push({status:"ERROR",timestamp:Date.now()});let n=[],i=new Set;for(let t of[...E,"ERROR"]){let e=a.find(e=>e.status===t);e&&!i.has(e.status)&&(n.push(e),i.add(e.status))}for(let t of a)i.has(t.status)||(n.push(t),i.add(t.status));return n.length?n:[{status:"ENRICHMENT_TRIGGERED",timestamp:s||Date.now()},{status:"WAITING_FOR_RESULTS",timestamp:(s||Date.now())+6e4}]};async function _(t){if(!o)return u.NextResponse.json({error:"SPRINGBOOT_BASE_URL is not configured."},{status:500});let e=t.nextUrl.searchParams.get("id");if(!e)return u.NextResponse.json({error:"Missing required `id` query parameter."},{status:400});let s=new URL(`/api/cleansed-context/${e}`,o),r=new URL(`/api/cleansed-data-status/${e}`,o);try{let[t,e]=await Promise.all([fetch(s),fetch(r)]),a=await t.text(),n=N(a),i=await e.text(),o=e.ok?d(i):null;if(!t.ok){let s=c([],o,Date.now());return u.NextResponse.json({upstream:{context:{status:t.status,ok:t.ok},pipeline:{status:e.status,ok:e.ok}},body:{statusHistory:s,latestStatus:o,startedAt:Date.now()},rawBody:a,pipelineRawBody:i},{status:e.ok?200:e.status})}let E=p(n)?n:{},R=I(E.startedAt)??I(E.metadata?.startedAt)??Date.now(),l=T(E.statusHistory,R),_=c(l,o,R),m={...E,statusHistory:_,latestStatus:o,startedAt:R};return u.NextResponse.json({upstream:{context:{status:t.status,ok:t.ok},pipeline:{status:e.status,ok:e.ok}},body:m,rawBody:a,pipelineRawBody:i},{status:200})}catch(t){return u.NextResponse.json({error:t instanceof Error?t.message:"Unable to reach enrichment status backing services."},{status:502})}}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/ingestion/enrichment/status/route",pathname:"/api/ingestion/enrichment/status",filename:"route",bundlePath:"app/api/ingestion/enrichment/status/route"},resolvedPagePath:"/Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/api/ingestion/enrichment/status/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:f,workUnitAsyncStorage:h,serverHooks:C}=m;function O(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:h})}},6487:()=>{},8335:()=>{}};var e=require("../../../../../webpack-runtime.js");e.C(t);var s=t=>e(e.s=t),r=e.X(0,[638,452],()=>s(5800));module.exports=r})();