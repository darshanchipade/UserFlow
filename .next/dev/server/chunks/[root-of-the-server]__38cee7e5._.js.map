{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/lib/server/extraction-snapshot.ts"],"sourcesContent":["import { promises as fs } from \"fs\";\nimport path from \"path\";\nimport { ExtractionSnapshot } from \"../extraction-snapshot\";\n\nconst CACHE_DIR =\n  process.env.EXTRACTION_CACHE_DIR ?? path.join(process.cwd(), \".extraction-cache\");\n\nconst ensureCacheDir = async () => {\n  await fs.mkdir(CACHE_DIR, { recursive: true });\n};\n\nexport const writeSnapshot = async (id: string, payload: ExtractionSnapshot) => {\n  if (!id) throw new Error(\"Snapshot id is required\");\n  await ensureCacheDir();\n  const target = path.join(CACHE_DIR, `${id}.json`);\n  await fs.writeFile(target, JSON.stringify(payload), \"utf8\");\n};\n\nexport const readSnapshot = async (id: string): Promise<ExtractionSnapshot | null> => {\n  try {\n    const file = path.join(CACHE_DIR, `${id}.json`);\n    const contents = await fs.readFile(file, \"utf8\");\n    return JSON.parse(contents) as ExtractionSnapshot;\n  } catch (error: unknown) {\n    if ((error as NodeJS.ErrnoException)?.code === \"ENOENT\") {\n      return null;\n    }\n    throw error;\n  }\n};\n\nexport const deleteSnapshot = async (id: string) => {\n  try {\n    const file = path.join(CACHE_DIR, `${id}.json`);\n    await fs.unlink(file);\n  } catch (error: unknown) {\n    if ((error as NodeJS.ErrnoException)?.code !== \"ENOENT\") {\n      throw error;\n    }\n  }\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAGA,MAAM,YACJ,QAAQ,GAAG,CAAC,oBAAoB,IAAI,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAE/D,MAAM,iBAAiB;IACrB,MAAM,yGAAE,CAAC,KAAK,CAAC,WAAW;QAAE,WAAW;IAAK;AAC9C;AAEO,MAAM,gBAAgB,OAAO,IAAY;IAC9C,IAAI,CAAC,IAAI,MAAM,IAAI,MAAM;IACzB,MAAM;IACN,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,WAAW,GAAG,GAAG,KAAK,CAAC;IAChD,MAAM,yGAAE,CAAC,SAAS,CAAC,QAAQ,KAAK,SAAS,CAAC,UAAU;AACtD;AAEO,MAAM,eAAe,OAAO;IACjC,IAAI;QACF,MAAM,OAAO,4GAAI,CAAC,IAAI,CAAC,WAAW,GAAG,GAAG,KAAK,CAAC;QAC9C,MAAM,WAAW,MAAM,yGAAE,CAAC,QAAQ,CAAC,MAAM;QACzC,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,OAAgB;QACvB,IAAI,AAAC,OAAiC,SAAS,UAAU;YACvD,OAAO;QACT;QACA,MAAM;IACR;AACF;AAEO,MAAM,iBAAiB,OAAO;IACnC,IAAI;QACF,MAAM,OAAO,4GAAI,CAAC,IAAI,CAAC,WAAW,GAAG,GAAG,KAAK,CAAC;QAC9C,MAAM,yGAAE,CAAC,MAAM,CAAC;IAClB,EAAE,OAAO,OAAgB;QACvB,IAAI,AAAC,OAAiC,SAAS,UAAU;YACvD,MAAM;QACR;IACF;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/api/ingestion/context/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { readSnapshot, writeSnapshot } from \"@/lib/server/extraction-snapshot\";\nimport type { ExtractionSnapshot } from \"@/lib/extraction-snapshot\";\n\ntype SnapshotPayload = {\n  id?: string;\n  payload?: Partial<ExtractionSnapshot>;\n};\n\nexport async function POST(request: NextRequest) {\n  let body: SnapshotPayload;\n  try {\n    body = await request.json();\n  } catch {\n    return NextResponse.json({ error: \"Request body must be JSON.\" }, { status: 400 });\n  }\n\n  const { id, payload } = body;\n  if (!id || typeof id !== \"string\") {\n    return NextResponse.json({ error: \"Field `id` is required.\" }, { status: 400 });\n  }\n  if (!payload || typeof payload !== \"object\") {\n    return NextResponse.json({ error: \"Field `payload` is required.\" }, { status: 400 });\n  }\n\n  const snapshot: ExtractionSnapshot = {\n    mode: payload.mode ?? \"local\",\n    metadata: payload.metadata ?? {\n      name: \"unknown\",\n      size: 0,\n      source: \"unknown\",\n      uploadedAt: Date.now(),\n    },\n    rawJson: payload.rawJson,\n    tree: payload.tree,\n    sourceUri: payload.sourceUri,\n    backendPayload: payload.backendPayload,\n    storedAt: Date.now(),\n  };\n\n  await writeSnapshot(id, snapshot);\n  return NextResponse.json({ ok: true });\n}\n\nexport async function GET(request: NextRequest) {\n  const id = request.nextUrl.searchParams.get(\"id\");\n  if (!id) {\n    return NextResponse.json(\n      { error: \"Missing required `id` query parameter.\" },\n      { status: 400 },\n    );\n  }\n\n  const snapshot = await readSnapshot(id);\n  if (!snapshot) {\n    return NextResponse.json({ error: \"Snapshot not found.\" }, { status: 404 });\n  }\n\n  return NextResponse.json(snapshot);\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAQO,eAAe,KAAK,OAAoB;IAC7C,IAAI;IACJ,IAAI;QACF,OAAO,MAAM,QAAQ,IAAI;IAC3B,EAAE,OAAM;QACN,OAAO,+LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,GAAG;IACxB,IAAI,CAAC,MAAM,OAAO,OAAO,UAAU;QACjC,OAAO,+LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IACA,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;QAC3C,OAAO,+LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;IAEA,MAAM,WAA+B;QACnC,MAAM,QAAQ,IAAI,IAAI;QACtB,UAAU,QAAQ,QAAQ,IAAI;YAC5B,MAAM;YACN,MAAM;YACN,QAAQ;YACR,YAAY,KAAK,GAAG;QACtB;QACA,SAAS,QAAQ,OAAO;QACxB,MAAM,QAAQ,IAAI;QAClB,WAAW,QAAQ,SAAS;QAC5B,gBAAgB,QAAQ,cAAc;QACtC,UAAU,KAAK,GAAG;IACpB;IAEA,MAAM,IAAA,gNAAa,EAAC,IAAI;IACxB,OAAO,+LAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,KAAK,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAC5C,IAAI,CAAC,IAAI;QACP,OAAO,+LAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyC,GAClD;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,WAAW,MAAM,IAAA,+MAAY,EAAC;IACpC,IAAI,CAAC,UAAU;QACb,OAAO,+LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;IAEA,OAAO,+LAAY,CAAC,IAAI,CAAC;AAC3B"}}]
}