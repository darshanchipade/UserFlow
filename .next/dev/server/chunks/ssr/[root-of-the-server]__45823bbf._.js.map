{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/lib/tree.ts"],"sourcesContent":["export type TreeNode = {\n  id: string;\n  label: string;\n  path: string;\n  type: \"object\" | \"array\" | \"value\";\n  children?: TreeNode[];\n  value?: unknown;\n};\n\nconst MAX_TREE_NODES = 5000;\nconst MAX_ARRAY_CHILDREN = 100;\n\nconst isPlainObject = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null && !Array.isArray(value);\n\nexport const buildTreeFromJson = (\n  payload: unknown,\n  parentPath: string[] = [],\n  counter: { value: number } = { value: 0 },\n): TreeNode[] => {\n  if (counter.value >= MAX_TREE_NODES) return [];\n\n  if (Array.isArray(payload)) {\n    return payload.slice(0, MAX_ARRAY_CHILDREN).flatMap((entry, index) => {\n      const label = `[${index}]`;\n      const id = [...parentPath, label].join(\".\");\n      counter.value += 1;\n      if (counter.value >= MAX_TREE_NODES) return [];\n\n      const childNodes = buildTreeFromJson(entry, [...parentPath, label], counter);\n      return [\n        {\n          id,\n          label,\n          path: id,\n          type: Array.isArray(entry)\n            ? \"array\"\n            : isPlainObject(entry)\n              ? \"object\"\n              : \"value\",\n          children: childNodes.length ? childNodes : undefined,\n          value:\n            !Array.isArray(entry) && !isPlainObject(entry)\n              ? entry\n              : childNodes.length === 0\n                ? entry\n                : undefined,\n        },\n      ];\n    });\n  }\n\n  if (isPlainObject(payload)) {\n    return Object.entries(payload).flatMap(([key, value]) => {\n      if (counter.value >= MAX_TREE_NODES) return [];\n      const id = [...parentPath, key].join(\".\");\n      counter.value += 1;\n      const childNodes = buildTreeFromJson(value, [...parentPath, key], counter);\n      return [\n        {\n          id,\n          label: key,\n          path: id,\n          type: Array.isArray(value)\n            ? \"array\"\n            : isPlainObject(value)\n              ? \"object\"\n              : \"value\",\n          children: childNodes.length ? childNodes : undefined,\n          value:\n            !Array.isArray(value) && !isPlainObject(value)\n              ? value\n              : childNodes.length === 0\n                ? value\n                : undefined,\n        },\n      ];\n    });\n  }\n\n  return [];\n};\n\nexport const gatherLeafNodes = (node: TreeNode): TreeNode[] => {\n  if (!node.children || node.children.length === 0) {\n    return [node];\n  }\n  return node.children.flatMap((child) => gatherLeafNodes(child));\n};\n\nexport const gatherNodeIds = (node: TreeNode): string[] => {\n  return [\n    node.id,\n    ...(node.children?.flatMap((child) => gatherNodeIds(child)) ?? []),\n  ];\n};\n\nexport const filterTree = (nodes: TreeNode[], query: string): TreeNode[] => {\n  if (!query) return nodes;\n  const normalized = query.toLowerCase();\n\n  const searchNode = (node: TreeNode): TreeNode | null => {\n    const matches = node.label.toLowerCase().includes(normalized);\n    if (!node.children || node.children.length === 0) {\n      return matches ? node : null;\n    }\n    const filteredChildren = node.children\n      .map(searchNode)\n      .filter((child): child is TreeNode => Boolean(child));\n    if (matches || filteredChildren.length > 0) {\n      return {\n        ...node,\n        children: filteredChildren.length ? filteredChildren : undefined,\n      };\n    }\n    return null;\n  };\n\n  return nodes\n    .map(searchNode)\n    .filter((node): node is TreeNode => Boolean(node));\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/lib/extraction-context.ts"],"sourcesContent":["import { TreeNode } from \"./tree\";\n\nexport type ExtractionContext = {\n  mode: \"local\" | \"api\" | \"s3\";\n  metadata: {\n    name: string;\n    size: number;\n    source: string;\n    cleansedId?: string;\n    status?: string;\n    uploadedAt: number;\n    sourceIdentifier?: string;\n    sourceType?: string;\n  };\n  sourceUri?: string;\n  snapshotId?: string;\n  /**\n   * @deprecated Legacy fields retained for backwards compatibility.\n   */\n  tree?: TreeNode[];\n  rawJson?: string;\n  backendPayload?: unknown;\n};\n\nexport type PersistenceFailureReason = \"ssr\" | \"quota\" | \"unknown\";\n\nexport type PersistenceResult = {\n  ok: boolean;\n  reason?: PersistenceFailureReason;\n  usedFallback?: boolean;\n};\n\nconst STORAGE_KEY = \"extraction-context\";\nconst CLEANSED_STORAGE_KEY = \"cleansed-context\";\nconst ENRICHMENT_STORAGE_KEY = \"enrichment-context\";\n\nconst MAX_CLEANSED_ITEMS = 150;\nconst MAX_CLEANSED_RAW_BODY_CHARS = 200_000;\n\nconst isQuotaExceededError = (error: unknown): error is DOMException => {\n  if (typeof DOMException === \"undefined\") return false;\n\n  return (\n    error instanceof DOMException &&\n    (error.name === \"QuotaExceededError\" ||\n      error.name === \"NS_ERROR_DOM_QUOTA_REACHED\" ||\n      error.code === 22 ||\n      error.code === 1014)\n  );\n};\n\nconst MAX_EXTRACTION_RAW_BODY_CHARS = 500_000;\n\nconst persistToSessionStorage = (key: string, payload: unknown): PersistenceResult => {\n  if (typeof window === \"undefined\") {\n    return { ok: false, reason: \"ssr\" };\n  }\n\n  try {\n    sessionStorage.setItem(key, JSON.stringify(payload));\n    return { ok: true };\n  } catch (error) {\n    if (isQuotaExceededError(error)) {\n      console.warn(`Session storage quota exceeded while saving '${key}'.`);\n      return { ok: false, reason: \"quota\" };\n    }\n\n    console.error(`Failed to persist '${key}' to sessionStorage`, error);\n    return { ok: false, reason: \"unknown\" };\n  }\n};\n\nconst safeLoad = <T>(serialized: string | null): T | null => {\n  if (!serialized) return null;\n\n  try {\n    return JSON.parse(serialized) as T;\n  } catch (error) {\n    console.error(\"Failed to parse session storage payload\", error);\n    return null;\n  }\n};\n\nconst sanitizeExtractionContext = (payload: ExtractionContext): ExtractionContext => {\n  const next: ExtractionContext = {\n    ...payload,\n    backendPayload: undefined,\n  };\n\n  if (typeof next.rawJson === \"string\" && next.rawJson.length > MAX_EXTRACTION_RAW_BODY_CHARS) {\n    next.rawJson = next.rawJson.slice(0, MAX_EXTRACTION_RAW_BODY_CHARS);\n  }\n\n  return next;\n};\n\nexport const saveExtractionContext = (payload: ExtractionContext) => {\n  const sanitized = sanitizeExtractionContext(payload);\n  return persistToSessionStorage(STORAGE_KEY, sanitized);\n};\n\nexport const loadExtractionContext = (): ExtractionContext | null => {\n  if (typeof window === \"undefined\") return null;\n  const stored = sessionStorage.getItem(STORAGE_KEY);\n  return safeLoad<ExtractionContext>(stored);\n};\n\nexport const clearExtractionContext = () => {\n  if (typeof window === \"undefined\") return;\n  sessionStorage.removeItem(STORAGE_KEY);\n};\n\nexport type CleansedContext = {\n  metadata: ExtractionContext[\"metadata\"];\n  items: unknown[];\n  rawBody?: string;\n  status?: string;\n  itemsTruncated?: boolean;\n  rawBodyTruncated?: boolean;\n  fallbackReason?: PersistenceFailureReason;\n};\n\nconst sanitizeCleansedPayload = (payload: CleansedContext): CleansedContext => {\n  const next: CleansedContext = {\n    ...payload,\n    items: Array.isArray(payload.items) ? [...payload.items] : [],\n  };\n\n  if (next.items.length > MAX_CLEANSED_ITEMS) {\n    next.items = next.items.slice(0, MAX_CLEANSED_ITEMS);\n    next.itemsTruncated = true;\n  }\n\n  if (typeof next.rawBody === \"string\" && next.rawBody.length > MAX_CLEANSED_RAW_BODY_CHARS) {\n    next.rawBody = next.rawBody.slice(0, MAX_CLEANSED_RAW_BODY_CHARS);\n    next.rawBodyTruncated = true;\n  }\n\n  return next;\n};\n\nexport const saveCleansedContext = (payload: CleansedContext): PersistenceResult => {\n  const sanitized = sanitizeCleansedPayload(payload);\n  const result = persistToSessionStorage(CLEANSED_STORAGE_KEY, sanitized);\n\n  if (!result.ok && result.reason === \"quota\") {\n    const fallbackPayload: CleansedContext = {\n      metadata: sanitized.metadata,\n      status: sanitized.status,\n      items: [],\n      fallbackReason: \"quota\",\n    };\n    const fallbackResult = persistToSessionStorage(CLEANSED_STORAGE_KEY, fallbackPayload);\n    if (fallbackResult.ok) {\n      return {\n        ok: true,\n        reason: \"quota\",\n        usedFallback: true,\n      };\n    }\n    return fallbackResult;\n  }\n\n  return result;\n};\n\nexport const loadCleansedContext = (): CleansedContext | null => {\n  if (typeof window === \"undefined\") return null;\n  const stored = sessionStorage.getItem(CLEANSED_STORAGE_KEY);\n  return safeLoad<CleansedContext>(stored);\n};\n\nexport const clearCleansedContext = () => {\n  if (typeof window === \"undefined\") return;\n  sessionStorage.removeItem(CLEANSED_STORAGE_KEY);\n};\n\nexport type EnrichmentStatusEntry = {\n  status: string;\n  timestamp: number;\n};\n\nexport type EnrichmentContext = {\n  metadata: ExtractionContext[\"metadata\"];\n  items?: unknown[];\n  startedAt: number;\n  statusHistory: EnrichmentStatusEntry[];\n};\n\nexport const saveEnrichmentContext = (payload: EnrichmentContext) => {\n  return persistToSessionStorage(ENRICHMENT_STORAGE_KEY, payload);\n};\n\nexport const loadEnrichmentContext = (): EnrichmentContext | null => {\n  if (typeof window === \"undefined\") return null;\n  const stored = sessionStorage.getItem(ENRICHMENT_STORAGE_KEY);\n  return safeLoad<EnrichmentContext>(stored);\n};\n\nexport const clearEnrichmentContext = () => {\n  if (typeof window === \"undefined\") return;\n  sessionStorage.removeItem(ENRICHMENT_STORAGE_KEY);\n};"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAgCA,MAAM,cAAc;AACpB,MAAM,uBAAuB;AAC7B,MAAM,yBAAyB;AAE/B,MAAM,qBAAqB;AAC3B,MAAM,8BAA8B;AAEpC,MAAM,uBAAuB,CAAC;IAC5B,IAAI,OAAO,iBAAiB,aAAa,OAAO;IAEhD,OACE,iBAAiB,gBACjB,CAAC,MAAM,IAAI,KAAK,wBACd,MAAM,IAAI,KAAK,gCACf,MAAM,IAAI,KAAK,MACf,MAAM,IAAI,KAAK,IAAI;AAEzB;AAEA,MAAM,gCAAgC;AAEtC,MAAM,0BAA0B,CAAC,KAAa;IAC5C,wCAAmC;QACjC,OAAO;YAAE,IAAI;YAAO,QAAQ;QAAM;IACpC;;;AAcF;AAEA,MAAM,WAAW,CAAI;IACnB,IAAI,CAAC,YAAY,OAAO;IAExB,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;QACzD,OAAO;IACT;AACF;AAEA,MAAM,4BAA4B,CAAC;IACjC,MAAM,OAA0B;QAC9B,GAAG,OAAO;QACV,gBAAgB;IAClB;IAEA,IAAI,OAAO,KAAK,OAAO,KAAK,YAAY,KAAK,OAAO,CAAC,MAAM,GAAG,+BAA+B;QAC3F,KAAK,OAAO,GAAG,KAAK,OAAO,CAAC,KAAK,CAAC,GAAG;IACvC;IAEA,OAAO;AACT;AAEO,MAAM,wBAAwB,CAAC;IACpC,MAAM,YAAY,0BAA0B;IAC5C,OAAO,wBAAwB,aAAa;AAC9C;AAEO,MAAM,wBAAwB;IACnC,wCAAmC,OAAO;;;IAC1C,MAAM;AAER;AAEO,MAAM,yBAAyB;IACpC,wCAAmC;;;AAErC;AAYA,MAAM,0BAA0B,CAAC;IAC/B,MAAM,OAAwB;QAC5B,GAAG,OAAO;QACV,OAAO,MAAM,OAAO,CAAC,QAAQ,KAAK,IAAI;eAAI,QAAQ,KAAK;SAAC,GAAG,EAAE;IAC/D;IAEA,IAAI,KAAK,KAAK,CAAC,MAAM,GAAG,oBAAoB;QAC1C,KAAK,KAAK,GAAG,KAAK,KAAK,CAAC,KAAK,CAAC,GAAG;QACjC,KAAK,cAAc,GAAG;IACxB;IAEA,IAAI,OAAO,KAAK,OAAO,KAAK,YAAY,KAAK,OAAO,CAAC,MAAM,GAAG,6BAA6B;QACzF,KAAK,OAAO,GAAG,KAAK,OAAO,CAAC,KAAK,CAAC,GAAG;QACrC,KAAK,gBAAgB,GAAG;IAC1B;IAEA,OAAO;AACT;AAEO,MAAM,sBAAsB,CAAC;IAClC,MAAM,YAAY,wBAAwB;IAC1C,MAAM,SAAS,wBAAwB,sBAAsB;IAE7D,IAAI,CAAC,OAAO,EAAE,IAAI,OAAO,MAAM,KAAK,SAAS;QAC3C,MAAM,kBAAmC;YACvC,UAAU,UAAU,QAAQ;YAC5B,QAAQ,UAAU,MAAM;YACxB,OAAO,EAAE;YACT,gBAAgB;QAClB;QACA,MAAM,iBAAiB,wBAAwB,sBAAsB;QACrE,IAAI,eAAe,EAAE,EAAE;YACrB,OAAO;gBACL,IAAI;gBACJ,QAAQ;gBACR,cAAc;YAChB;QACF;QACA,OAAO;IACT;IAEA,OAAO;AACT;AAEO,MAAM,sBAAsB;IACjC,wCAAmC,OAAO;;;IAC1C,MAAM;AAER;AAEO,MAAM,uBAAuB;IAClC,wCAAmC;;;AAErC;AAcO,MAAM,wBAAwB,CAAC;IACpC,OAAO,wBAAwB,wBAAwB;AACzD;AAEO,MAAM,wBAAwB;IACnC,wCAAmC,OAAO;;;IAC1C,MAAM;AAER;AAEO,MAAM,yBAAyB;IACpC,wCAAmC;;;AAErC"}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/lib/client/snapshot-store.ts"],"sourcesContent":["\"use client\";\n\nimport type { ExtractionSnapshot } from \"@/lib/extraction-snapshot\";\n\nconst DB_NAME = \"ExtractionSnapshots\";\nconst STORE_NAME = \"snapshots\";\n\ntype SnapshotStoreResult =\n  | { ok: true }\n  | {\n      ok: false;\n      message?: string;\n    };\n\nconst openDatabase = (): Promise<IDBDatabase> => {\n  return new Promise((resolve, reject) => {\n    if (typeof window === \"undefined\" || !window.indexedDB) {\n      reject(new Error(\"IndexedDB is not available in this environment.\"));\n      return;\n    }\n\n    const request = window.indexedDB.open(DB_NAME, 1);\n\n    request.onerror = () => {\n      reject(request.error ?? new Error(\"Failed to open IndexedDB.\"));\n    };\n\n    request.onupgradeneeded = () => {\n      const db = request.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME);\n      }\n    };\n\n    request.onsuccess = () => {\n      resolve(request.result);\n    };\n  });\n};\n\nexport const storeClientSnapshot = async (\n  id: string,\n  payload: ExtractionSnapshot,\n): Promise<SnapshotStoreResult> => {\n  try {\n    const db = await openDatabase();\n    await new Promise<void>((resolve, reject) => {\n      const transaction = db.transaction(STORE_NAME, \"readwrite\");\n      const store = transaction.objectStore(STORE_NAME);\n      const request = store.put(payload, id);\n\n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error ?? new Error(\"Failed to store snapshot.\"));\n    });\n    return { ok: true };\n  } catch (error) {\n    return {\n      ok: false,\n      message:\n        error instanceof Error ? error.message : \"Failed to store snapshot in IndexedDB.\",\n    };\n  }\n};\n\nexport const readClientSnapshot = async (\n  id: string,\n): Promise<ExtractionSnapshot | null> => {\n  try {\n    const db = await openDatabase();\n    return await new Promise((resolve, reject) => {\n      const transaction = db.transaction(STORE_NAME, \"readonly\");\n      const store = transaction.objectStore(STORE_NAME);\n      const request = store.get(id);\n      request.onsuccess = () => resolve((request.result as ExtractionSnapshot) ?? null);\n      request.onerror = () => reject(request.error ?? new Error(\"Failed to read snapshot.\"));\n    });\n  } catch {\n    return null;\n  }\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAIA,MAAM,UAAU;AAChB,MAAM,aAAa;AASnB,MAAM,eAAe;IACnB,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,wCAAwD;YACtD,OAAO,IAAI,MAAM;YACjB;QACF;;;QAEA,MAAM;IAgBR;AACF;AAEO,MAAM,sBAAsB,OACjC,IACA;IAEA,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,MAAM,IAAI,QAAc,CAAC,SAAS;YAChC,MAAM,cAAc,GAAG,WAAW,CAAC,YAAY;YAC/C,MAAM,QAAQ,YAAY,WAAW,CAAC;YACtC,MAAM,UAAU,MAAM,GAAG,CAAC,SAAS;YAEnC,QAAQ,SAAS,GAAG,IAAM;YAC1B,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK,IAAI,IAAI,MAAM;QAC5D;QACA,OAAO;YAAE,IAAI;QAAK;IACpB,EAAE,OAAO,OAAO;QACd,OAAO;YACL,IAAI;YACJ,SACE,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC7C;IACF;AACF;AAEO,MAAM,qBAAqB,OAChC;IAEA,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,OAAO,MAAM,IAAI,QAAQ,CAAC,SAAS;YACjC,MAAM,cAAc,GAAG,WAAW,CAAC,YAAY;YAC/C,MAAM,QAAQ,YAAY,WAAW,CAAC;YACtC,MAAM,UAAU,MAAM,GAAG,CAAC;YAC1B,QAAQ,SAAS,GAAG,IAAM,QAAQ,AAAC,QAAQ,MAAM,IAA2B;YAC5E,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK,IAAI,IAAI,MAAM;QAC5D;IACF,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/components/PipelineTracker.tsx"],"sourcesContent":["\"use client\";\n\nimport clsx from \"clsx\";\n\ntype StepId = \"ingestion\" | \"extraction\" | \"cleansing\" | \"enrichment\" | \"qa\";\n\nconst STEPS: Array<{ id: StepId; label: string }> = [\n  { id: \"ingestion\", label: \"Ingestion\" },\n  { id: \"extraction\", label: \"Extraction\" },\n  { id: \"cleansing\", label: \"Cleansing\" },\n  { id: \"enrichment\", label: \"Data Enrichment\" },\n  { id: \"qa\", label: \"Content QA\" },\n];\n\nexport function PipelineTracker({ current }: { current: StepId }) {\n  const currentIndex = STEPS.findIndex((step) => step.id === current);\n\n  return (\n    <nav className=\"hidden flex-wrap items-center gap-2 text-xs font-semibold text-slate-500 md:flex\">\n      {STEPS.map((step, index) => {\n        const status =\n          index < currentIndex ? \"done\" : index === currentIndex ? \"current\" : \"upcoming\";\n        return (\n          <div key={step.id} className=\"flex items-center gap-2\">\n            <span\n              className={clsx(\n                \"rounded-full px-3 py-1 transition\",\n                status === \"current\"\n                  ? \"bg-indigo-50 text-indigo-600\"\n                  : status === \"done\"\n                    ? \"bg-emerald-50 text-emerald-700\"\n                    : \"bg-slate-100 text-slate-500\",\n              )}\n            >\n              {step.label}\n            </span>\n            {index < STEPS.length - 1 && <span className=\"text-slate-300\">—</span>}\n          </div>\n        );\n      })}\n    </nav>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAMA,MAAM,QAA8C;IAClD;QAAE,IAAI;QAAa,OAAO;IAAY;IACtC;QAAE,IAAI;QAAc,OAAO;IAAa;IACxC;QAAE,IAAI;QAAa,OAAO;IAAY;IACtC;QAAE,IAAI;QAAc,OAAO;IAAkB;IAC7C;QAAE,IAAI;QAAM,OAAO;IAAa;CACjC;AAEM,SAAS,gBAAgB,EAAE,OAAO,EAAuB;IAC9D,MAAM,eAAe,MAAM,SAAS,CAAC,CAAC,OAAS,KAAK,EAAE,KAAK;IAE3D,qBACE,6RAAC;QAAI,WAAU;kBACZ,MAAM,GAAG,CAAC,CAAC,MAAM;YAChB,MAAM,SACJ,QAAQ,eAAe,SAAS,UAAU,eAAe,YAAY;YACvE,qBACE,6RAAC;gBAAkB,WAAU;;kCAC3B,6RAAC;wBACC,WAAW,IAAA,+LAAI,EACb,qCACA,WAAW,YACP,iCACA,WAAW,SACT,mCACA;kCAGP,KAAK,KAAK;;;;;;oBAEZ,QAAQ,MAAM,MAAM,GAAG,mBAAK,6RAAC;wBAAK,WAAU;kCAAiB;;;;;;;eAbtD,KAAK,EAAE;;;;;QAgBrB;;;;;;AAGN"}},
    {"offset": {"line": 406, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/lib/source.ts"],"sourcesContent":["export const pickString = (value: unknown): string | undefined => {\n  if (typeof value !== \"string\") return undefined;\n  const trimmed = value.trim();\n  return trimmed.length ? trimmed : undefined;\n};\n\nexport const inferSourceType = (\n  explicitType?: string,\n  identifier?: string,\n  fallback?: string,\n): string | undefined => {\n  const normalized = explicitType?.toLowerCase();\n  if (normalized) {\n    return normalized;\n  }\n  if (!identifier) {\n    return fallback;\n  }\n  const token = identifier.toLowerCase();\n  if (token.startsWith(\"file-upload\") || token.startsWith(\"local:\")) {\n    return \"file\";\n  }\n  if (token.startsWith(\"api-payload\") || token.includes(\"api\")) {\n    return \"api\";\n  }\n  if (token.startsWith(\"s3://\") || token.includes(\"s3\")) {\n    return \"s3\";\n  }\n  if (token.startsWith(\"classpath:\")) {\n    return \"classpath\";\n  }\n  return fallback;\n};\n\nexport const describeSourceLabel = (\n  type?: string,\n  fallback = \"Unknown source\",\n): string => {\n  if (!type) return fallback;\n  const normalized = type.toLowerCase();\n  if (normalized.includes(\"api\")) return \"API payload\";\n  if (normalized.includes(\"s3\") || normalized.includes(\"cloud\")) return \"S3 / Cloud\";\n  if (normalized.includes(\"class\")) return \"Classpath resource\";\n  if (normalized.includes(\"local\")) return \"Local upload\";\n  if (normalized.includes(\"file\")) return \"File upload\";\n  return type;\n};"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,aAAa,CAAC;IACzB,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,UAAU,MAAM,IAAI;IAC1B,OAAO,QAAQ,MAAM,GAAG,UAAU;AACpC;AAEO,MAAM,kBAAkB,CAC7B,cACA,YACA;IAEA,MAAM,aAAa,cAAc;IACjC,IAAI,YAAY;QACd,OAAO;IACT;IACA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IACA,MAAM,QAAQ,WAAW,WAAW;IACpC,IAAI,MAAM,UAAU,CAAC,kBAAkB,MAAM,UAAU,CAAC,WAAW;QACjE,OAAO;IACT;IACA,IAAI,MAAM,UAAU,CAAC,kBAAkB,MAAM,QAAQ,CAAC,QAAQ;QAC5D,OAAO;IACT;IACA,IAAI,MAAM,UAAU,CAAC,YAAY,MAAM,QAAQ,CAAC,OAAO;QACrD,OAAO;IACT;IACA,IAAI,MAAM,UAAU,CAAC,eAAe;QAClC,OAAO;IACT;IACA,OAAO;AACT;AAEO,MAAM,sBAAsB,CACjC,MACA,WAAW,gBAAgB;IAE3B,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,aAAa,KAAK,WAAW;IACnC,IAAI,WAAW,QAAQ,CAAC,QAAQ,OAAO;IACvC,IAAI,WAAW,QAAQ,CAAC,SAAS,WAAW,QAAQ,CAAC,UAAU,OAAO;IACtE,IAAI,WAAW,QAAQ,CAAC,UAAU,OAAO;IACzC,IAAI,WAAW,QAAQ,CAAC,UAAU,OAAO;IACzC,IAAI,WAAW,QAAQ,CAAC,SAAS,OAAO;IACxC,OAAO;AACT"}},
    {"offset": {"line": 456, "column": 0}, "map": {"version":3,"sources":["file:///Users/darshanchipade/Documents/GitHub/UserFlow/UserFlow/src/app/extraction/page.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  ArrowPathIcon,\n  CheckCircleIcon,\n  ChevronDownIcon,\n  ChevronRightIcon,\n  ExclamationCircleIcon,\n  InboxStackIcon,\n  MagnifyingGlassIcon,\n} from \"@heroicons/react/24/outline\";\nimport clsx from \"clsx\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport {\n  TreeNode,\n  buildTreeFromJson,\n  filterTree,\n} from \"@/lib/tree\";\nimport {\n  ExtractionContext,\n  clearExtractionContext,\n  loadExtractionContext,\n  saveCleansedContext,\n  type PersistenceResult,\n} from \"@/lib/extraction-context\";\nimport type { ExtractionSnapshot } from \"@/lib/extraction-snapshot\";\nimport { readClientSnapshot } from \"@/lib/client/snapshot-store\";\nimport { PipelineTracker } from \"@/components/PipelineTracker\";\nimport { describeSourceLabel, inferSourceType, pickString } from \"@/lib/source\";\n\nconst formatBytes = (bytes: number) => {\n  if (!Number.isFinite(bytes)) return \"—\";\n  if (bytes === 0) return \"0 B\";\n  const units = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const index = Math.floor(Math.log(bytes) / Math.log(1024));\n  const value = bytes / Math.pow(1024, index);\n  return `${value.toFixed(value > 9 || index === 0 ? 0 : 1)} ${units[index]}`;\n};\n\nconst safeJsonParse = (value: string | undefined) => {\n  if (!value) return null;\n  try {\n    return JSON.parse(value);\n  } catch {\n    return null;\n  }\n};\n\ntype Feedback = {\n  state: \"idle\" | \"loading\" | \"success\" | \"error\";\n  message?: string;\n};\n\nconst FeedbackPill = ({ feedback }: { feedback: Feedback }) => {\n  if (feedback.state === \"idle\") return null;\n  const className = clsx(\n    \"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold\",\n    feedback.state === \"success\"\n      ? \"bg-emerald-50 text-emerald-700\"\n      : feedback.state === \"error\"\n        ? \"bg-rose-50 text-rose-700\"\n        : \"bg-indigo-50 text-indigo-600\",\n  );\n  const Icon =\n    feedback.state === \"loading\"\n      ? ArrowPathIcon\n      : feedback.state === \"success\"\n        ? CheckCircleIcon\n        : ExclamationCircleIcon;\n  const message =\n    feedback.message ??\n    (feedback.state === \"loading\"\n      ? \"Contacting backend...\"\n      : feedback.state === \"success\"\n        ? \"Completed successfully.\"\n        : \"Something went wrong.\");\n  return (\n    <div className={className}>\n      <Icon className={clsx(\"size-4\", feedback.state === \"loading\" && \"animate-spin\")} />\n      {message}\n    </div>\n  );\n};\n\nconst getValueAtPath = (payload: any, path: string) => {\n  if (!payload) return undefined;\n  const segments = path.split(\".\");\n  let current: any = payload;\n  for (const segment of segments) {\n    if (!segment) continue;\n    if (segment.startsWith(\"[\")) {\n      const index = Number(segment.replace(/[^0-9]/g, \"\"));\n      if (!Array.isArray(current) || Number.isNaN(index)) {\n        return undefined;\n      }\n      current = current[index];\n    } else if (current && typeof current === \"object\") {\n      current = current[segment];\n    } else {\n      return undefined;\n    }\n  }\n  return current;\n};\n\nconst flattenTree = (nodes: TreeNode[]) => {\n  const map = new Map<string, TreeNode>();\n  const traverse = (node: TreeNode) => {\n    map.set(node.id, node);\n    node.children?.forEach(traverse);\n  };\n  nodes.forEach(traverse);\n  return map;\n};\n\nconst isRecord = (value: unknown): value is Record<string, unknown> => {\n  return typeof value === \"object\" && value !== null;\n};\n\nconst extractItemsFromBackend = (payload: unknown): unknown[] => {\n  if (Array.isArray(payload)) return payload;\n  if (isRecord(payload)) {\n    const candidates = [\n      payload.items,\n      payload.records,\n      payload.data,\n      payload.payload,\n      payload.cleansedItems,\n      payload.originalItems,\n      payload.result,\n      payload.body,\n      payload.cleansedItems,\n      payload.originalItems,\n      payload.result,\n      payload.body,\n    ];\n\n    for (const candidate of candidates) {\n      if (Array.isArray(candidate)) {\n        return candidate;\n      }\n      if (candidate && typeof candidate === \"object\") {\n        const record = candidate as Record<string, unknown>;\n        if (Array.isArray(record.items)) {\n          return record.items as unknown[];\n        }\n      }\n    }\n  }\n  return [];\n};\n\nconst extractStatusFromBackend = (payload: unknown): string | undefined => {\n  if (!isRecord(payload)) return undefined;\n  const candidates = [\n    payload.status,\n    payload.state,\n    payload.currentStatus,\n    payload.pipelineStatus,\n  ];\n  return candidates.find((value) => typeof value === \"string\") as string | undefined;\n};\n\nconst buildCleansedContextPayload = (\n  metadata: ExtractionContext[\"metadata\"],\n  backendResponse: any,\n) => {\n  const body = backendResponse?.body ?? backendResponse;\n  const bodyRecord =\n    body && typeof body === \"object\" && !Array.isArray(body)\n      ? (body as Record<string, unknown>)\n      : null;\n  const metadataRecord =\n    bodyRecord?.metadata && typeof bodyRecord.metadata === \"object\"\n      ? (bodyRecord.metadata as Record<string, unknown>)\n      : null;\n  const sourceIdentifier =\n    pickString(bodyRecord?.sourceIdentifier) ??\n    pickString(bodyRecord?.sourceUri) ??\n    pickString(metadataRecord?.sourceIdentifier) ??\n    metadata.sourceIdentifier;\n  const sourceType =\n    inferSourceType(\n      pickString(bodyRecord?.sourceType) ?? pickString(metadataRecord?.sourceType),\n      sourceIdentifier ?? metadata.sourceIdentifier,\n      metadata.sourceType,\n    ) ?? metadata.sourceType;\n  const cleansedId =\n    pickString(bodyRecord?.cleansedDataStoreId) ??\n    pickString(bodyRecord?.cleansedId) ??\n    metadata.cleansedId;\n  const mergedMetadata: ExtractionContext[\"metadata\"] = {\n    ...metadata,\n    sourceIdentifier: sourceIdentifier ?? metadata.sourceIdentifier,\n    sourceType: sourceType ?? metadata.sourceType,\n    source: describeSourceLabel(sourceType ?? metadata.sourceType, metadata.source),\n    cleansedId: cleansedId ?? metadata.cleansedId,\n  };\n  return {\n    metadata: mergedMetadata,\n    items: extractItemsFromBackend(body),\n    rawBody: typeof backendResponse?.rawBody === \"string\" ? backendResponse.rawBody : undefined,\n    status: extractStatusFromBackend(body) ?? extractStatusFromBackend(backendResponse),\n  };\n};\n\nconst composeSuccessMessage = (storageResult?: PersistenceResult) => {\n  if (!storageResult) {\n    return \"Cleansing pipeline triggered.\";\n  }\n  if (!storageResult.ok) {\n    return \"Cleansing pipeline triggered, but preview caching failed.\";\n  }\n  if (storageResult.usedFallback) {\n    return \"Cleansing pipeline triggered. Preview cached partially because the payload is large.\";\n  }\n  return \"Cleansing pipeline triggered.\";\n};\n\nexport default function ExtractionPage() {\n  const router = useRouter();\n  const [hydrated, setHydrated] = useState(false);\n  const [context, setContext] = useState<ExtractionContext | null>(null);\n  const [parsedJson, setParsedJson] = useState<any>(null);\n  const [treeNodes, setTreeNodes] = useState<TreeNode[]>([]);\n  const [expandedNodes, setExpandedNodes] = useState<Set<string>>(new Set());\n  const [activeNodeId, setActiveNodeId] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [feedback, setFeedback] = useState<Feedback>({ state: \"idle\" });\n  const [sending, setSending] = useState(false);\n  const [nodeMap, setNodeMap] = useState<Map<string, TreeNode>>(new Map());\n  const [snapshot, setSnapshot] = useState<ExtractionSnapshot | null>(null);\n  const [snapshotLoading, setSnapshotLoading] = useState(false);\n  const [snapshotError, setSnapshotError] = useState<string | null>(null);\n  const [snapshotVersion, setSnapshotVersion] = useState(0);\n\n  useEffect(() => {\n    setHydrated(true);\n  }, []);\n\n  const applyTreeFromNodes = useCallback((nodes: TreeNode[]) => {\n    const flattened = flattenTree(nodes);\n    setTreeNodes(nodes);\n    setNodeMap(flattened);\n    setExpandedNodes(new Set(nodes.map((node) => node.id)));\n    setActiveNodeId((previous) => {\n      if (previous && flattened.has(previous)) {\n        return previous;\n      }\n      return nodes[0]?.id ?? null;\n    });\n  }, []);\n\n  const hydrateStructure = useCallback(\n    (tree?: TreeNode[], rawJson?: string) => {\n      if (tree && tree.length) {\n        applyTreeFromNodes(tree);\n        setParsedJson(rawJson ? safeJsonParse(rawJson) : null);\n        return;\n      }\n\n      if (rawJson) {\n        const parsed = safeJsonParse(rawJson);\n        setParsedJson(parsed);\n        if (parsed) {\n          const nodes = buildTreeFromJson(parsed, [], { value: 0 });\n          if (nodes.length) {\n            applyTreeFromNodes(nodes);\n          } else {\n            setTreeNodes([]);\n            setNodeMap(new Map<string, TreeNode>());\n            setExpandedNodes(new Set());\n            setActiveNodeId(null);\n          }\n        } else {\n          setTreeNodes([]);\n          setNodeMap(new Map<string, TreeNode>());\n          setExpandedNodes(new Set());\n          setActiveNodeId(null);\n        }\n        return;\n      }\n\n      setTreeNodes([]);\n      setNodeMap(new Map<string, TreeNode>());\n      setExpandedNodes(new Set());\n      setActiveNodeId(null);\n      setParsedJson(null);\n    },\n    [applyTreeFromNodes],\n  );\n\n  useEffect(() => {\n    const payload = loadExtractionContext();\n    if (!payload) return;\n    setContext(payload);\n    if ((payload.tree && payload.tree.length) || payload.rawJson) {\n      hydrateStructure(payload.tree, payload.rawJson);\n    }\n  }, [hydrateStructure]);\n\n  useEffect(() => {\n    if (!context?.snapshotId) {\n      setSnapshot(null);\n      setSnapshotLoading(false);\n      setSnapshotError(null);\n      return;\n    }\n\n    const snapshotId = context.snapshotId;\n    let cancelled = false;\n    const loadSnapshot = async () => {\n      if (snapshotVersion === 0) {\n        setSnapshot(null);\n      }\n      setSnapshotLoading(true);\n      setSnapshotError(null);\n      try {\n        let snapshotPayload: ExtractionSnapshot | null = null;\n        if (snapshotId.startsWith(\"local:\")) {\n          snapshotPayload = await readClientSnapshot(snapshotId);\n          if (!snapshotPayload) {\n            throw new Error(\"Local extraction snapshot not found.\");\n          }\n        } else {\n          const response = await fetch(\n            `/api/ingestion/context?id=${encodeURIComponent(snapshotId)}`,\n          );\n          let body: any = null;\n          try {\n            body = await response.json();\n          } catch {\n            // ignore parse errors\n          }\n          if (!response.ok) {\n            throw new Error(body?.error ?? \"Failed to load extraction snapshot.\");\n          }\n          snapshotPayload = body as ExtractionSnapshot;\n        }\n        if (cancelled) return;\n        setSnapshot(snapshotPayload);\n        hydrateStructure(snapshotPayload?.tree, snapshotPayload?.rawJson);\n        setSnapshotLoading(false);\n      } catch (error) {\n        if (cancelled) return;\n        setSnapshotError(\n          error instanceof Error\n            ? error.message\n            : \"Failed to load extraction snapshot.\",\n        );\n        setSnapshotLoading(false);\n      }\n    };\n\n    loadSnapshot();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [context?.snapshotId, snapshotVersion, hydrateStructure]);\n\n  const retrySnapshotFetch = () => {\n    if (context?.snapshotId) {\n      setSnapshotVersion((value) => value + 1);\n    }\n  };\n\n  const filteredTree = useMemo(\n    () => filterTree(treeNodes, searchQuery),\n    [treeNodes, searchQuery],\n  );\n\n  const activeNode = useMemo(\n    () => (activeNodeId ? nodeMap.get(activeNodeId) ?? null : null),\n    [activeNodeId, nodeMap],\n  );\n\n  const activeValue = useMemo(() => {\n    if (!activeNodeId) return undefined;\n    const node = nodeMap.get(activeNodeId);\n    if (!node) return undefined;\n    if (\"value\" in node) {\n      return node.value;\n    }\n    if (!parsedJson) return undefined;\n    return getValueAtPath(parsedJson, node.path.replace(/^[^\\.]+\\.?/, \"\"));\n  }, [activeNodeId, nodeMap, parsedJson]);\n\n  const toggleNode = (nodeId: string) => {\n    setExpandedNodes((previous) => {\n      const next = new Set(previous);\n      if (next.has(nodeId)) {\n        next.delete(nodeId);\n      } else {\n        next.add(nodeId);\n      }\n      return next;\n    });\n  };\n\n  const renderTree = (nodes: TreeNode[]) =>\n    nodes.map((node) => {\n      const hasChildren = Boolean(node.children?.length);\n      const expanded = expandedNodes.has(node.id);\n      const selected = activeNodeId === node.id;\n\n      return (\n        <div key={node.id} className=\"space-y-2\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              setActiveNodeId(node.id);\n              if (hasChildren) toggleNode(node.id);\n            }}\n            className={clsx(\n              \"flex w-full items-center gap-2 rounded-lg px-2 py-1.5 text-left\",\n              selected ? \"bg-indigo-50 text-indigo-700\" : \"text-slate-700\",\n            )}\n          >\n            {hasChildren ? (\n              <span className=\"text-slate-500\">\n                {expanded ? (\n                  <ChevronDownIcon className=\"size-4\" />\n                ) : (\n                  <ChevronRightIcon className=\"size-4\" />\n                )}\n              </span>\n            ) : (\n              <span className=\"size-4\" />\n            )}\n            <div className=\"flex flex-col\">\n              <span className=\"text-sm font-medium\">{node.label}</span>\n              {!hasChildren && (\n                <span className=\"text-xs text-slate-500\">{node.path}</span>\n              )}\n            </div>\n          </button>\n          {hasChildren && expanded && (\n            <div className=\"border-l border-slate-100 pl-4\">\n              {renderTree(node.children!)}\n            </div>\n          )}\n        </div>\n      );\n    });\n\n  const sendToCleansing = async () => {\n    if (!context) return;\n    setSending(true);\n    setFeedback({ state: \"loading\" });\n\n    try {\n      let response: Response;\n      const snapshotRawJson = snapshot?.rawJson ?? context.rawJson;\n      const cleansedId = context.metadata.cleansedId;\n\n      if (cleansedId) {\n        response = await fetch(`/api/ingestion/resume/${encodeURIComponent(cleansedId)}`, {\n          method: \"POST\",\n        });\n      } else if (context.mode === \"s3\" && context.sourceUri) {\n        response = await fetch(\"/api/ingestion/s3\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ sourceUri: context.sourceUri }),\n        });\n      } else if (snapshotRawJson) {\n        const parsed = safeJsonParse(snapshotRawJson);\n        if (!parsed) {\n          throw new Error(\"Original JSON is no longer available.\");\n        }\n        response = await fetch(\"/api/ingestion/payload\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ payload: parsed }),\n        });\n      } else {\n        throw new Error(\"No payload available to send to cleansing.\");\n      }\n\n      const payload = await response.json();\n      let storageResult: PersistenceResult | undefined;\n\n      if (response.ok) {\n        storageResult = saveCleansedContext(\n          buildCleansedContextPayload(context.metadata, payload),\n        );\n        if (!storageResult.ok) {\n          console.warn(\n            \"Unable to cache cleansed response locally; continuing without snapshot.\",\n            storageResult.reason,\n          );\n        }\n      }\n\n      setFeedback({\n        state: response.ok ? \"success\" : \"error\",\n        message: response.ok\n          ? composeSuccessMessage(storageResult)\n          : payload?.error ?? \"Backend rejected the request.\",\n      });\n\n      if (response.ok) {\n        router.push(\"/cleansing\");\n      }\n    } catch (error) {\n      setFeedback({\n        state: \"error\",\n        message:\n          error instanceof Error ? error.message : \"Failed to send to cleansing.\",\n      });\n    } finally {\n      setSending(false);\n    }\n  };\n\n  if (!hydrated) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-slate-50\">\n        <div className=\"rounded-3xl border border-slate-200 bg-white p-10 text-center shadow-sm\">\n          <p className=\"text-xs uppercase tracking-wide text-slate-400\">Extraction</p>\n          <h1 className=\"mt-3 text-lg font-semibold text-slate-900\">Preparing workspace…</h1>\n          <p className=\"mt-2 text-sm text-slate-500\">Loading your latest extraction context.</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!context) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-slate-50\">\n        <div className=\"rounded-3xl border border-slate-200 bg-white p-10 shadow-sm\">\n          <p className=\"text-lg font-semibold text-slate-900\">\n            Extraction context not found.\n          </p>\n          <p className=\"mt-2 text-sm text-slate-500\">\n            Start from the ingestion page to select a file or payload.\n          </p>\n          <button\n            type=\"button\"\n            onClick={() => router.push(\"/ingestion\")}\n            className=\"mt-6 rounded-full bg-slate-900 px-6 py-2 text-sm font-semibold text-white\"\n          >\n            Back to Ingestion\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  const sourceLabel = describeSourceLabel(\n    context.metadata.sourceType ?? context.metadata.source,\n    context.metadata.source,\n  );\n  const sourceIdentifier =\n    context.metadata.sourceIdentifier ?? context.metadata.source ?? \"—\";\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      <header className=\"border-b border-slate-200 bg-white\">\n        <div className=\"mx-auto flex max-w-6xl flex-col gap-4 px-6 py-4 md:flex-row md:items-center md:justify-between\">\n          <div>\n            <p className=\"text-xs uppercase tracking-wide text-slate-400\">\n              Extraction\n            </p>\n            <h1 className=\"text-xl font-semibold text-slate-900\">\n              Review structured content\n            </h1>\n          </div>\n          <div className=\"flex flex-1 flex-col items-start gap-3 md:flex-row md:items-center md:justify-end\">\n            <PipelineTracker current=\"extraction\" />\n            <FeedbackPill feedback={feedback} />\n          </div>\n        </div>\n      </header>\n\n      <main className=\"mx-auto flex max-w-6xl flex-col gap-6 px-6 py-8\">\n        <div className=\"grid gap-6 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]\">\n          <section className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-xs uppercase tracking-wide text-slate-400\">\n                  File structure\n                </p>\n                <h2 className=\"text-lg font-semibold text-slate-900\">\n                  {context.metadata.name}\n                </h2>\n              </div>\n              <button\n                type=\"button\"\n                onClick={sendToCleansing}\n                disabled={sending}\n                className={clsx(\n                  \"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white\",\n                  sending && \"cursor-not-allowed opacity-60\",\n                )}\n              >\n                {sending ? (\n                  <>\n                    <ArrowPathIcon className=\"size-4 animate-spin\" /> Sending…\n                  </>\n                ) : (\n                  \"Send to Cleansing\"\n                )}\n              </button>\n            </div>\n            <div className=\"mt-4 flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs text-slate-600\">\n              <InboxStackIcon className=\"size-4 text-slate-500\" />\n              <span className=\"font-semibold text-slate-700\">{sourceLabel}</span>\n            </div>\n            <div className=\"mt-4\">\n              <div className=\"relative\">\n                <MagnifyingGlassIcon className=\"pointer-events-none absolute left-3 top-2.5 size-4 text-slate-400\" />\n                <input\n                  type=\"search\"\n                  placeholder=\"Search fields...\"\n                  value={searchQuery}\n                  onChange={(event) => setSearchQuery(event.target.value)}\n                  className=\"w-full rounded-2xl border border-slate-200 bg-slate-50 py-2 pl-9 pr-3 text-sm text-slate-900 focus:border-indigo-500 focus:bg-white focus:outline-none\"\n                />\n              </div>\n              <div className=\"mt-4 max-h-[420px] space-y-3 overflow-y-auto pr-2\">\n                {snapshotLoading && context?.snapshotId && (\n                  <div className=\"rounded-2xl border border-slate-200 bg-white py-6 text-center text-sm text-slate-600\">\n                    Loading extracted data snapshot…\n                  </div>\n                )}\n                {!snapshotLoading && snapshotError && context?.snapshotId && (\n                  <div className=\"rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900\">\n                    <p className=\"font-semibold\">Unable to load the cached structure.</p>\n                    <p className=\"mt-1\">{snapshotError}</p>\n                    <button\n                      type=\"button\"\n                      onClick={retrySnapshotFetch}\n                      className=\"mt-3 rounded-full bg-amber-600 px-3 py-1 text-xs font-semibold text-white\"\n                    >\n                      Retry download\n                    </button>\n                  </div>\n                )}\n                {filteredTree.length === 0 ? (\n                  <div className=\"rounded-2xl border border-dashed border-slate-200 py-10 text-center text-sm text-slate-500\">\n                    Structure preview isn’t available yet. Re-run ingestion if this persists.\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">{renderTree(filteredTree)}</div>\n                )}\n              </div>\n            </div>\n          </section>\n\n          <section className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n            <p className=\"text-xs uppercase tracking-wide text-slate-400\">\n              Data overview\n            </p>\n            <h2 className=\"text-lg font-semibold text-slate-900\">\n              Field details\n            </h2>\n            <div className=\"mt-4 space-y-3 rounded-2xl bg-slate-50 p-4\">\n              <div>\n                <p className=\"text-xs uppercase tracking-wide text-slate-400\">\n                  Field\n                </p>\n                <p className=\"text-sm font-semibold text-slate-900\">\n                  {activeNode?.label ?? \"Select a node\"}\n                </p>\n                {activeNode && (\n                  <p className=\"text-xs text-slate-500\">{activeNode.path}</p>\n                )}\n              </div>\n              <div>\n                <p className=\"text-xs uppercase tracking-wide text-slate-400\">\n                  Original value\n                </p>\n                <pre className=\"max-h-48 overflow-y-auto rounded-xl bg-white p-3 text-sm text-slate-800\">\n                  {activeValue === undefined\n                    ? \"—\"\n                    : typeof activeValue === \"object\"\n                      ? JSON.stringify(activeValue, null, 2)\n                      : String(activeValue)}\n                </pre>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        <section className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold text-slate-900\">File metadata</h3>\n            <button\n              type=\"button\"\n              onClick={() => {\n                clearExtractionContext();\n                router.push(\"/ingestion\");\n              }}\n              className=\"text-xs font-semibold text-indigo-600\"\n            >\n              Start over\n            </button>\n          </div>\n          <dl className=\"mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Name</dt>\n              <dd className=\"text-sm font-semibold text-slate-900\">{context.metadata.name}</dd>\n            </div>\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Size</dt>\n              <dd className=\"text-sm font-semibold text-slate-900\">\n                {formatBytes(context.metadata.size)}\n              </dd>\n            </div>\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Source type</dt>\n              <dd className=\"text-sm font-semibold text-slate-900\">{sourceLabel}</dd>\n            </div>\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Source identifier</dt>\n              <dd className=\"text-sm font-semibold text-slate-900 break-all\">{sourceIdentifier}</dd>\n            </div>\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Cleansed ID</dt>\n              <dd className=\"text-sm font-semibold text-slate-900\">\n                {context.metadata.cleansedId ?? \"—\"}\n              </dd>\n            </div>\n            <div>\n              <dt className=\"text-xs uppercase tracking-wide text-slate-400\">Uploaded</dt>\n              <dd className=\"text-sm font-semibold text-slate-900\">\n                {new Date(context.metadata.uploadedAt).toLocaleString()}\n              </dd>\n            </div>\n          </dl>\n        </section>\n      </main>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAKA;AAQA;AACA;AACA;AA7BA;;;;;;;;;;;AA+BA,MAAM,cAAc,CAAC;IACnB,IAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ,OAAO;IACpC,IAAI,UAAU,GAAG,OAAO;IACxB,MAAM,QAAQ;QAAC;QAAK;QAAM;QAAM;KAAK;IACrC,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC;IACpD,MAAM,QAAQ,QAAQ,KAAK,GAAG,CAAC,MAAM;IACrC,OAAO,GAAG,MAAM,OAAO,CAAC,QAAQ,KAAK,UAAU,IAAI,IAAI,GAAG,CAAC,EAAE,KAAK,CAAC,MAAM,EAAE;AAC7E;AAEA,MAAM,gBAAgB,CAAC;IACrB,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAOA,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA0B;IACxD,IAAI,SAAS,KAAK,KAAK,QAAQ,OAAO;IACtC,MAAM,YAAY,IAAA,+LAAI,EACpB,+EACA,SAAS,KAAK,KAAK,YACf,mCACA,SAAS,KAAK,KAAK,UACjB,6BACA;IAER,MAAM,OACJ,SAAS,KAAK,KAAK,YACf,yRAAa,GACb,SAAS,KAAK,KAAK,YACjB,+RAAe,GACf,iTAAqB;IAC7B,MAAM,UACJ,SAAS,OAAO,IAChB,CAAC,SAAS,KAAK,KAAK,YAChB,0BACA,SAAS,KAAK,KAAK,YACjB,4BACA,uBAAuB;IAC/B,qBACE,6RAAC;QAAI,WAAW;;0BACd,6RAAC;gBAAK,WAAW,IAAA,+LAAI,EAAC,UAAU,SAAS,KAAK,KAAK,aAAa;;;;;;YAC/D;;;;;;;AAGP;AAEA,MAAM,iBAAiB,CAAC,SAAc;IACpC,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,WAAW,KAAK,KAAK,CAAC;IAC5B,IAAI,UAAe;IACnB,KAAK,MAAM,WAAW,SAAU;QAC9B,IAAI,CAAC,SAAS;QACd,IAAI,QAAQ,UAAU,CAAC,MAAM;YAC3B,MAAM,QAAQ,OAAO,QAAQ,OAAO,CAAC,WAAW;YAChD,IAAI,CAAC,MAAM,OAAO,CAAC,YAAY,OAAO,KAAK,CAAC,QAAQ;gBAClD,OAAO;YACT;YACA,UAAU,OAAO,CAAC,MAAM;QAC1B,OAAO,IAAI,WAAW,OAAO,YAAY,UAAU;YACjD,UAAU,OAAO,CAAC,QAAQ;QAC5B,OAAO;YACL,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEA,MAAM,cAAc,CAAC;IACnB,MAAM,MAAM,IAAI;IAChB,MAAM,WAAW,CAAC;QAChB,IAAI,GAAG,CAAC,KAAK,EAAE,EAAE;QACjB,KAAK,QAAQ,EAAE,QAAQ;IACzB;IACA,MAAM,OAAO,CAAC;IACd,OAAO;AACT;AAEA,MAAM,WAAW,CAAC;IAChB,OAAO,OAAO,UAAU,YAAY,UAAU;AAChD;AAEA,MAAM,0BAA0B,CAAC;IAC/B,IAAI,MAAM,OAAO,CAAC,UAAU,OAAO;IACnC,IAAI,SAAS,UAAU;QACrB,MAAM,aAAa;YACjB,QAAQ,KAAK;YACb,QAAQ,OAAO;YACf,QAAQ,IAAI;YACZ,QAAQ,OAAO;YACf,QAAQ,aAAa;YACrB,QAAQ,aAAa;YACrB,QAAQ,MAAM;YACd,QAAQ,IAAI;YACZ,QAAQ,aAAa;YACrB,QAAQ,aAAa;YACrB,QAAQ,MAAM;YACd,QAAQ,IAAI;SACb;QAED,KAAK,MAAM,aAAa,WAAY;YAClC,IAAI,MAAM,OAAO,CAAC,YAAY;gBAC5B,OAAO;YACT;YACA,IAAI,aAAa,OAAO,cAAc,UAAU;gBAC9C,MAAM,SAAS;gBACf,IAAI,MAAM,OAAO,CAAC,OAAO,KAAK,GAAG;oBAC/B,OAAO,OAAO,KAAK;gBACrB;YACF;QACF;IACF;IACA,OAAO,EAAE;AACX;AAEA,MAAM,2BAA2B,CAAC;IAChC,IAAI,CAAC,SAAS,UAAU,OAAO;IAC/B,MAAM,aAAa;QACjB,QAAQ,MAAM;QACd,QAAQ,KAAK;QACb,QAAQ,aAAa;QACrB,QAAQ,cAAc;KACvB;IACD,OAAO,WAAW,IAAI,CAAC,CAAC,QAAU,OAAO,UAAU;AACrD;AAEA,MAAM,8BAA8B,CAClC,UACA;IAEA,MAAM,OAAO,iBAAiB,QAAQ;IACtC,MAAM,aACJ,QAAQ,OAAO,SAAS,YAAY,CAAC,MAAM,OAAO,CAAC,QAC9C,OACD;IACN,MAAM,iBACJ,YAAY,YAAY,OAAO,WAAW,QAAQ,KAAK,WAClD,WAAW,QAAQ,GACpB;IACN,MAAM,mBACJ,IAAA,iLAAU,EAAC,YAAY,qBACvB,IAAA,iLAAU,EAAC,YAAY,cACvB,IAAA,iLAAU,EAAC,gBAAgB,qBAC3B,SAAS,gBAAgB;IAC3B,MAAM,aACJ,IAAA,sLAAe,EACb,IAAA,iLAAU,EAAC,YAAY,eAAe,IAAA,iLAAU,EAAC,gBAAgB,aACjE,oBAAoB,SAAS,gBAAgB,EAC7C,SAAS,UAAU,KAChB,SAAS,UAAU;IAC1B,MAAM,aACJ,IAAA,iLAAU,EAAC,YAAY,wBACvB,IAAA,iLAAU,EAAC,YAAY,eACvB,SAAS,UAAU;IACrB,MAAM,iBAAgD;QACpD,GAAG,QAAQ;QACX,kBAAkB,oBAAoB,SAAS,gBAAgB;QAC/D,YAAY,cAAc,SAAS,UAAU;QAC7C,QAAQ,IAAA,0LAAmB,EAAC,cAAc,SAAS,UAAU,EAAE,SAAS,MAAM;QAC9E,YAAY,cAAc,SAAS,UAAU;IAC/C;IACA,OAAO;QACL,UAAU;QACV,OAAO,wBAAwB;QAC/B,SAAS,OAAO,iBAAiB,YAAY,WAAW,gBAAgB,OAAO,GAAG;QAClF,QAAQ,yBAAyB,SAAS,yBAAyB;IACrE;AACF;AAEA,MAAM,wBAAwB,CAAC;IAC7B,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI,CAAC,cAAc,EAAE,EAAE;QACrB,OAAO;IACT;IACA,IAAI,cAAc,YAAY,EAAE;QAC9B,OAAO;IACT;IACA,OAAO;AACT;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,8LAAS;IACxB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gQAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gQAAQ,EAA2B;IACjE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gQAAQ,EAAM;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gQAAQ,EAAa,EAAE;IACzD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,gQAAQ,EAAc,IAAI;IACpE,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,gQAAQ,EAAgB;IAChE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gQAAQ,EAAC;IAC/C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gQAAQ,EAAW;QAAE,OAAO;IAAO;IACnE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gQAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gQAAQ,EAAwB,IAAI;IAClE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gQAAQ,EAA4B;IACpE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,gQAAQ,EAAC;IACvD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,gQAAQ,EAAgB;IAClE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,gQAAQ,EAAC;IAEvD,IAAA,iQAAS,EAAC;QACR,YAAY;IACd,GAAG,EAAE;IAEL,MAAM,qBAAqB,IAAA,mQAAW,EAAC,CAAC;QACtC,MAAM,YAAY,YAAY;QAC9B,aAAa;QACb,WAAW;QACX,iBAAiB,IAAI,IAAI,MAAM,GAAG,CAAC,CAAC,OAAS,KAAK,EAAE;QACpD,gBAAgB,CAAC;YACf,IAAI,YAAY,UAAU,GAAG,CAAC,WAAW;gBACvC,OAAO;YACT;YACA,OAAO,KAAK,CAAC,EAAE,EAAE,MAAM;QACzB;IACF,GAAG,EAAE;IAEL,MAAM,mBAAmB,IAAA,mQAAW,EAClC,CAAC,MAAmB;QAClB,IAAI,QAAQ,KAAK,MAAM,EAAE;YACvB,mBAAmB;YACnB,cAAc,UAAU,cAAc,WAAW;YACjD;QACF;QAEA,IAAI,SAAS;YACX,MAAM,SAAS,cAAc;YAC7B,cAAc;YACd,IAAI,QAAQ;gBACV,MAAM,QAAQ,IAAA,sLAAiB,EAAC,QAAQ,EAAE,EAAE;oBAAE,OAAO;gBAAE;gBACvD,IAAI,MAAM,MAAM,EAAE;oBAChB,mBAAmB;gBACrB,OAAO;oBACL,aAAa,EAAE;oBACf,WAAW,IAAI;oBACf,iBAAiB,IAAI;oBACrB,gBAAgB;gBAClB;YACF,OAAO;gBACL,aAAa,EAAE;gBACf,WAAW,IAAI;gBACf,iBAAiB,IAAI;gBACrB,gBAAgB;YAClB;YACA;QACF;QAEA,aAAa,EAAE;QACf,WAAW,IAAI;QACf,iBAAiB,IAAI;QACrB,gBAAgB;QAChB,cAAc;IAChB,GACA;QAAC;KAAmB;IAGtB,IAAA,iQAAS,EAAC;QACR,MAAM,UAAU,IAAA,2MAAqB;QACrC,IAAI,CAAC,SAAS;QACd,WAAW;QACX,IAAI,AAAC,QAAQ,IAAI,IAAI,QAAQ,IAAI,CAAC,MAAM,IAAK,QAAQ,OAAO,EAAE;YAC5D,iBAAiB,QAAQ,IAAI,EAAE,QAAQ,OAAO;QAChD;IACF,GAAG;QAAC;KAAiB;IAErB,IAAA,iQAAS,EAAC;QACR,IAAI,CAAC,SAAS,YAAY;YACxB,YAAY;YACZ,mBAAmB;YACnB,iBAAiB;YACjB;QACF;QAEA,MAAM,aAAa,QAAQ,UAAU;QACrC,IAAI,YAAY;QAChB,MAAM,eAAe;YACnB,IAAI,oBAAoB,GAAG;gBACzB,YAAY;YACd;YACA,mBAAmB;YACnB,iBAAiB;YACjB,IAAI;gBACF,IAAI,kBAA6C;gBACjD,IAAI,WAAW,UAAU,CAAC,WAAW;oBACnC,kBAAkB,MAAM,IAAA,8MAAkB,EAAC;oBAC3C,IAAI,CAAC,iBAAiB;wBACpB,MAAM,IAAI,MAAM;oBAClB;gBACF,OAAO;oBACL,MAAM,WAAW,MAAM,MACrB,CAAC,0BAA0B,EAAE,mBAAmB,aAAa;oBAE/D,IAAI,OAAY;oBAChB,IAAI;wBACF,OAAO,MAAM,SAAS,IAAI;oBAC5B,EAAE,OAAM;oBACN,sBAAsB;oBACxB;oBACA,IAAI,CAAC,SAAS,EAAE,EAAE;wBAChB,MAAM,IAAI,MAAM,MAAM,SAAS;oBACjC;oBACA,kBAAkB;gBACpB;gBACA,IAAI,WAAW;gBACf,YAAY;gBACZ,iBAAiB,iBAAiB,MAAM,iBAAiB;gBACzD,mBAAmB;YACrB,EAAE,OAAO,OAAO;gBACd,IAAI,WAAW;gBACf,iBACE,iBAAiB,QACb,MAAM,OAAO,GACb;gBAEN,mBAAmB;YACrB;QACF;QAEA;QAEA,OAAO;YACL,YAAY;QACd;IACF,GAAG;QAAC,SAAS;QAAY;QAAiB;KAAiB;IAE3D,MAAM,qBAAqB;QACzB,IAAI,SAAS,YAAY;YACvB,mBAAmB,CAAC,QAAU,QAAQ;QACxC;IACF;IAEA,MAAM,eAAe,IAAA,+PAAO,EAC1B,IAAM,IAAA,+KAAU,EAAC,WAAW,cAC5B;QAAC;QAAW;KAAY;IAG1B,MAAM,aAAa,IAAA,+PAAO,EACxB,IAAO,eAAe,QAAQ,GAAG,CAAC,iBAAiB,OAAO,MAC1D;QAAC;QAAc;KAAQ;IAGzB,MAAM,cAAc,IAAA,+PAAO,EAAC;QAC1B,IAAI,CAAC,cAAc,OAAO;QAC1B,MAAM,OAAO,QAAQ,GAAG,CAAC;QACzB,IAAI,CAAC,MAAM,OAAO;QAClB,IAAI,WAAW,MAAM;YACnB,OAAO,KAAK,KAAK;QACnB;QACA,IAAI,CAAC,YAAY,OAAO;QACxB,OAAO,eAAe,YAAY,KAAK,IAAI,CAAC,OAAO,CAAC,cAAc;IACpE,GAAG;QAAC;QAAc;QAAS;KAAW;IAEtC,MAAM,aAAa,CAAC;QAClB,iBAAiB,CAAC;YAChB,MAAM,OAAO,IAAI,IAAI;YACrB,IAAI,KAAK,GAAG,CAAC,SAAS;gBACpB,KAAK,MAAM,CAAC;YACd,OAAO;gBACL,KAAK,GAAG,CAAC;YACX;YACA,OAAO;QACT;IACF;IAEA,MAAM,aAAa,CAAC,QAClB,MAAM,GAAG,CAAC,CAAC;YACT,MAAM,cAAc,QAAQ,KAAK,QAAQ,EAAE;YAC3C,MAAM,WAAW,cAAc,GAAG,CAAC,KAAK,EAAE;YAC1C,MAAM,WAAW,iBAAiB,KAAK,EAAE;YAEzC,qBACE,6RAAC;gBAAkB,WAAU;;kCAC3B,6RAAC;wBACC,MAAK;wBACL,SAAS;4BACP,gBAAgB,KAAK,EAAE;4BACvB,IAAI,aAAa,WAAW,KAAK,EAAE;wBACrC;wBACA,WAAW,IAAA,+LAAI,EACb,mEACA,WAAW,iCAAiC;;4BAG7C,4BACC,6RAAC;gCAAK,WAAU;0CACb,yBACC,6RAAC,+RAAe;oCAAC,WAAU;;;;;yDAE3B,6RAAC,kSAAgB;oCAAC,WAAU;;;;;;;;;;qDAIhC,6RAAC;gCAAK,WAAU;;;;;;0CAElB,6RAAC;gCAAI,WAAU;;kDACb,6RAAC;wCAAK,WAAU;kDAAuB,KAAK,KAAK;;;;;;oCAChD,CAAC,6BACA,6RAAC;wCAAK,WAAU;kDAA0B,KAAK,IAAI;;;;;;;;;;;;;;;;;;oBAIxD,eAAe,0BACd,6RAAC;wBAAI,WAAU;kCACZ,WAAW,KAAK,QAAQ;;;;;;;eAhCrB,KAAK,EAAE;;;;;QAqCrB;IAEF,MAAM,kBAAkB;QACtB,IAAI,CAAC,SAAS;QACd,WAAW;QACX,YAAY;YAAE,OAAO;QAAU;QAE/B,IAAI;YACF,IAAI;YACJ,MAAM,kBAAkB,UAAU,WAAW,QAAQ,OAAO;YAC5D,MAAM,aAAa,QAAQ,QAAQ,CAAC,UAAU;YAE9C,IAAI,YAAY;gBACd,WAAW,MAAM,MAAM,CAAC,sBAAsB,EAAE,mBAAmB,aAAa,EAAE;oBAChF,QAAQ;gBACV;YACF,OAAO,IAAI,QAAQ,IAAI,KAAK,QAAQ,QAAQ,SAAS,EAAE;gBACrD,WAAW,MAAM,MAAM,qBAAqB;oBAC1C,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE,WAAW,QAAQ,SAAS;oBAAC;gBACtD;YACF,OAAO,IAAI,iBAAiB;gBAC1B,MAAM,SAAS,cAAc;gBAC7B,IAAI,CAAC,QAAQ;oBACX,MAAM,IAAI,MAAM;gBAClB;gBACA,WAAW,MAAM,MAAM,0BAA0B;oBAC/C,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE,SAAS;oBAAO;gBACzC;YACF,OAAO;gBACL,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,UAAU,MAAM,SAAS,IAAI;YACnC,IAAI;YAEJ,IAAI,SAAS,EAAE,EAAE;gBACf,gBAAgB,IAAA,yMAAmB,EACjC,4BAA4B,QAAQ,QAAQ,EAAE;gBAEhD,IAAI,CAAC,cAAc,EAAE,EAAE;oBACrB,QAAQ,IAAI,CACV,2EACA,cAAc,MAAM;gBAExB;YACF;YAEA,YAAY;gBACV,OAAO,SAAS,EAAE,GAAG,YAAY;gBACjC,SAAS,SAAS,EAAE,GAChB,sBAAsB,iBACtB,SAAS,SAAS;YACxB;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,OAAO,IAAI,CAAC;YACd;QACF,EAAE,OAAO,OAAO;YACd,YAAY;gBACV,OAAO;gBACP,SACE,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAC7C;QACF,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAI,CAAC,UAAU;QACb,qBACE,6RAAC;YAAI,WAAU;sBACb,cAAA,6RAAC;gBAAI,WAAU;;kCACb,6RAAC;wBAAE,WAAU;kCAAiD;;;;;;kCAC9D,6RAAC;wBAAG,WAAU;kCAA4C;;;;;;kCAC1D,6RAAC;wBAAE,WAAU;kCAA8B;;;;;;;;;;;;;;;;;IAInD;IAEA,IAAI,CAAC,SAAS;QACZ,qBACE,6RAAC;YAAI,WAAU;sBACb,cAAA,6RAAC;gBAAI,WAAU;;kCACb,6RAAC;wBAAE,WAAU;kCAAuC;;;;;;kCAGpD,6RAAC;wBAAE,WAAU;kCAA8B;;;;;;kCAG3C,6RAAC;wBACC,MAAK;wBACL,SAAS,IAAM,OAAO,IAAI,CAAC;wBAC3B,WAAU;kCACX;;;;;;;;;;;;;;;;;IAMT;IAEA,MAAM,cAAc,IAAA,0LAAmB,EACrC,QAAQ,QAAQ,CAAC,UAAU,IAAI,QAAQ,QAAQ,CAAC,MAAM,EACtD,QAAQ,QAAQ,CAAC,MAAM;IAEzB,MAAM,mBACJ,QAAQ,QAAQ,CAAC,gBAAgB,IAAI,QAAQ,QAAQ,CAAC,MAAM,IAAI;IAElE,qBACE,6RAAC;QAAI,WAAU;;0BACb,6RAAC;gBAAO,WAAU;0BAChB,cAAA,6RAAC;oBAAI,WAAU;;sCACb,6RAAC;;8CACC,6RAAC;oCAAE,WAAU;8CAAiD;;;;;;8CAG9D,6RAAC;oCAAG,WAAU;8CAAuC;;;;;;;;;;;;sCAIvD,6RAAC;4BAAI,WAAU;;8CACb,6RAAC,uMAAe;oCAAC,SAAQ;;;;;;8CACzB,6RAAC;oCAAa,UAAU;;;;;;;;;;;;;;;;;;;;;;;0BAK9B,6RAAC;gBAAK,WAAU;;kCACd,6RAAC;wBAAI,WAAU;;0CACb,6RAAC;gCAAQ,WAAU;;kDACjB,6RAAC;wCAAI,WAAU;;0DACb,6RAAC;;kEACC,6RAAC;wDAAE,WAAU;kEAAiD;;;;;;kEAG9D,6RAAC;wDAAG,WAAU;kEACX,QAAQ,QAAQ,CAAC,IAAI;;;;;;;;;;;;0DAG1B,6RAAC;gDACC,MAAK;gDACL,SAAS;gDACT,UAAU;gDACV,WAAW,IAAA,+LAAI,EACb,uGACA,WAAW;0DAGZ,wBACC;;sEACE,6RAAC,yRAAa;4DAAC,WAAU;;;;;;wDAAwB;;mEAGnD;;;;;;;;;;;;kDAIN,6RAAC;wCAAI,WAAU;;0DACb,6RAAC,4RAAc;gDAAC,WAAU;;;;;;0DAC1B,6RAAC;gDAAK,WAAU;0DAAgC;;;;;;;;;;;;kDAElD,6RAAC;wCAAI,WAAU;;0DACb,6RAAC;gDAAI,WAAU;;kEACb,6RAAC,2SAAmB;wDAAC,WAAU;;;;;;kEAC/B,6RAAC;wDACC,MAAK;wDACL,aAAY;wDACZ,OAAO;wDACP,UAAU,CAAC,QAAU,eAAe,MAAM,MAAM,CAAC,KAAK;wDACtD,WAAU;;;;;;;;;;;;0DAGd,6RAAC;gDAAI,WAAU;;oDACZ,mBAAmB,SAAS,4BAC3B,6RAAC;wDAAI,WAAU;kEAAuF;;;;;;oDAIvG,CAAC,mBAAmB,iBAAiB,SAAS,4BAC7C,6RAAC;wDAAI,WAAU;;0EACb,6RAAC;gEAAE,WAAU;0EAAgB;;;;;;0EAC7B,6RAAC;gEAAE,WAAU;0EAAQ;;;;;;0EACrB,6RAAC;gEACC,MAAK;gEACL,SAAS;gEACT,WAAU;0EACX;;;;;;;;;;;;oDAKJ,aAAa,MAAM,KAAK,kBACvB,6RAAC;wDAAI,WAAU;kEAA6F;;;;;6EAI5G,6RAAC;wDAAI,WAAU;kEAAa,WAAW;;;;;;;;;;;;;;;;;;;;;;;;0CAM/C,6RAAC;gCAAQ,WAAU;;kDACjB,6RAAC;wCAAE,WAAU;kDAAiD;;;;;;kDAG9D,6RAAC;wCAAG,WAAU;kDAAuC;;;;;;kDAGrD,6RAAC;wCAAI,WAAU;;0DACb,6RAAC;;kEACC,6RAAC;wDAAE,WAAU;kEAAiD;;;;;;kEAG9D,6RAAC;wDAAE,WAAU;kEACV,YAAY,SAAS;;;;;;oDAEvB,4BACC,6RAAC;wDAAE,WAAU;kEAA0B,WAAW,IAAI;;;;;;;;;;;;0DAG1D,6RAAC;;kEACC,6RAAC;wDAAE,WAAU;kEAAiD;;;;;;kEAG9D,6RAAC;wDAAI,WAAU;kEACZ,gBAAgB,YACb,MACA,OAAO,gBAAgB,WACrB,KAAK,SAAS,CAAC,aAAa,MAAM,KAClC,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAOvB,6RAAC;wBAAQ,WAAU;;0CACjB,6RAAC;gCAAI,WAAU;;kDACb,6RAAC;wCAAG,WAAU;kDAAuC;;;;;;kDACrD,6RAAC;wCACC,MAAK;wCACL,SAAS;4CACP,IAAA,4MAAsB;4CACtB,OAAO,IAAI,CAAC;wCACd;wCACA,WAAU;kDACX;;;;;;;;;;;;0CAIH,6RAAC;gCAAG,WAAU;;kDACZ,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DAAwC,QAAQ,QAAQ,CAAC,IAAI;;;;;;;;;;;;kDAE7E,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DACX,YAAY,QAAQ,QAAQ,CAAC,IAAI;;;;;;;;;;;;kDAGtC,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DAAwC;;;;;;;;;;;;kDAExD,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DAAkD;;;;;;;;;;;;kDAElE,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DACX,QAAQ,QAAQ,CAAC,UAAU,IAAI;;;;;;;;;;;;kDAGpC,6RAAC;;0DACC,6RAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,6RAAC;gDAAG,WAAU;0DACX,IAAI,KAAK,QAAQ,QAAQ,CAAC,UAAU,EAAE,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQrE"}}]
}